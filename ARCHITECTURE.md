# ç³»ç»Ÿæ¶æ„æ–‡æ¡£ | System Architecture

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†ç”µå•†å¹³å°çš„ç³»ç»Ÿæ¶æ„è®¾è®¡ã€‚

**ç‰ˆæœ¬**: 2.0.0  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ31æ—¥

---

## ğŸ“‹ ç›®å½•

- [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [ç³»ç»Ÿåˆ†å±‚](#ç³»ç»Ÿåˆ†å±‚)
- [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
- [ç¼“å­˜ç­–ç•¥](#ç¼“å­˜ç­–ç•¥)
- [API è®¾è®¡](#api-è®¾è®¡)
- [å®‰å…¨æ¶æ„](#å®‰å…¨æ¶æ„)
- [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
- [æ‰©å±•æ€§è®¾è®¡](#æ‰©å±•æ€§è®¾è®¡)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)

---

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å±‚ (Client)                       â”‚
â”‚                    Web Browser / Mobile                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯å±‚ (Frontend)                        â”‚
â”‚              Next.js 14 + React 18 + TypeScript              â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç”¨æˆ·ç•Œé¢ â”‚  â”‚ ç®¡ç†åå° â”‚  â”‚ çŠ¶æ€ç®¡ç† â”‚  â”‚ è·¯ç”±ç®¡ç† â”‚   â”‚
â”‚  â”‚  Pages   â”‚  â”‚  Admin   â”‚  â”‚ Zustand  â”‚  â”‚  Router  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ REST API (JSON)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API ç½‘å…³ (Gateway)                      â”‚
â”‚                    Express.js + Middleware                   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è®¤è¯ä¸­é—´ â”‚  â”‚ é™æµä¸­é—´ â”‚  â”‚ æ—¥å¿—ä¸­é—´ â”‚  â”‚ é”™è¯¯å¤„ç† â”‚   â”‚
â”‚  â”‚   ä»¶     â”‚  â”‚   ä»¶     â”‚  â”‚   ä»¶     â”‚  â”‚   ä¸­é—´ä»¶ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸šåŠ¡é€»è¾‘å±‚ (Business)                      â”‚
â”‚                      Controllers + Models                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç”¨æˆ·æœåŠ¡ â”‚  â”‚ å•†å“æœåŠ¡ â”‚  â”‚ è®¢å•æœåŠ¡ â”‚  â”‚ æ”¯ä»˜æœåŠ¡ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è´­ç‰©è½¦   â”‚  â”‚ è¯„è®ºæœåŠ¡ â”‚  â”‚ æ”¶è—æœåŠ¡ â”‚  â”‚ æœç´¢æœåŠ¡ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚ æµè§ˆå†å² â”‚  â”‚ ç®¡ç†æœåŠ¡ â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®è®¿é—®å±‚ (Data)                         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MySQL   â”‚  â”‚  Redis   â”‚  â”‚ MongoDB  â”‚  â”‚Elasticsearchâ”‚ â”‚
â”‚  â”‚ å…³ç³»æ•°æ® â”‚  â”‚  ç¼“å­˜    â”‚  â”‚ æ–‡æ¡£æ•°æ® â”‚  â”‚  å…¨æ–‡æœç´¢  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„ç‰¹ç‚¹

- **å‰åç«¯åˆ†ç¦»**: å‰ç«¯ Next.jsï¼Œåç«¯ Express.js
- **å¾®æœåŠ¡åŒ–**: æŒ‰ä¸šåŠ¡åŠŸèƒ½æ¨¡å—åŒ–è®¾è®¡
- **å¤šæ•°æ®åº“**: MySQL + Redis + MongoDB + Elasticsearch
- **RESTful API**: æ ‡å‡†åŒ–çš„ API è®¾è®¡
- **å®¹å™¨åŒ–éƒ¨ç½²**: Docker + Docker Compose

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‰ç«¯æŠ€æœ¯æ ˆ                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¡†æ¶å±‚                                   â”‚
â”‚  â€¢ Next.js 14 (React Framework)         â”‚
â”‚  â€¢ React 18 (UI Library)                â”‚
â”‚  â€¢ TypeScript 5 (Type System)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çŠ¶æ€ç®¡ç†                                 â”‚
â”‚  â€¢ Zustand 4 (Global State)             â”‚
â”‚  â€¢ React Hooks (Local State)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ ·å¼å±‚                                   â”‚
â”‚  â€¢ TailwindCSS 3 (Utility CSS)          â”‚
â”‚  â€¢ PostCSS (CSS Processing)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®è¯·æ±‚                                 â”‚
â”‚  â€¢ Axios (HTTP Client)                  â”‚
â”‚  â€¢ SWR (Data Fetching)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UI ç»„ä»¶                                  â”‚
â”‚  â€¢ React Icons (Icons)                  â”‚
â”‚  â€¢ React Hot Toast (Notifications)      â”‚
â”‚  â€¢ Recharts (Charts)                    â”‚
â”‚  â€¢ Swiper (Carousel)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åç«¯æŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åç«¯æŠ€æœ¯æ ˆ                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿è¡Œæ—¶                                   â”‚
â”‚  â€¢ Node.js 18+ (Runtime)                â”‚
â”‚  â€¢ TypeScript 5 (Language)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Web æ¡†æ¶                                 â”‚
â”‚  â€¢ Express 4 (Web Framework)            â”‚
â”‚  â€¢ CORS (Cross-Origin)                  â”‚
â”‚  â€¢ Helmet (Security Headers)            â”‚
â”‚  â€¢ Compression (Response Compression)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®åº“                                   â”‚
â”‚  â€¢ MySQL 8.0 (Relational DB)            â”‚
â”‚  â€¢ mysql2 (MySQL Driver)                â”‚
â”‚  â€¢ MongoDB 7 (Document DB)              â”‚
â”‚  â€¢ Mongoose (MongoDB ODM)               â”‚
â”‚  â€¢ Redis 7 (Cache & Session)            â”‚
â”‚  â€¢ ioredis (Redis Client)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è®¤è¯ä¸å®‰å…¨                               â”‚
â”‚  â€¢ JWT (jsonwebtoken)                   â”‚
â”‚  â€¢ Bcrypt (Password Hashing)            â”‚
â”‚  â€¢ express-rate-limit (Rate Limiting)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å·¥å…·åº“                                   â”‚
â”‚  â€¢ dotenv (Environment Variables)       â”‚
â”‚  â€¢ uuid (Unique ID Generation)          â”‚
â”‚  â€¢ joi (Validation)                     â”‚
â”‚  â€¢ multer (File Upload)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š ç³»ç»Ÿåˆ†å±‚

### 1. è¡¨ç°å±‚ (Presentation Layer)

**èŒè´£**: ç”¨æˆ·ç•Œé¢å±•ç¤ºå’Œäº¤äº’

```typescript
// ç»„ä»¶ç»“æ„
src/app/
â”œâ”€â”€ page.tsx                 // é¦–é¡µ
â”œâ”€â”€ products/
â”‚   â”œâ”€â”€ page.tsx            // å•†å“åˆ—è¡¨
â”‚   â””â”€â”€ [id]/page.tsx       // å•†å“è¯¦æƒ…
â”œâ”€â”€ cart/page.tsx           // è´­ç‰©è½¦
â”œâ”€â”€ orders/page.tsx         // è®¢å•åˆ—è¡¨
â”œâ”€â”€ admin/                  // ç®¡ç†åå°
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ products/
â”‚   â”œâ”€â”€ orders/
â”‚   â””â”€â”€ users/
â””â”€â”€ components/             // å…±äº«ç»„ä»¶
    â”œâ”€â”€ Header.tsx
    â”œâ”€â”€ ProductCard.tsx
    â””â”€â”€ AdminLayout.tsx
```

**æŠ€æœ¯å®ç°**:
- Server-Side Rendering (SSR) é¦–å±æ¸²æŸ“
- Client-Side Rendering (CSR) äº¤äº’é¡µé¢
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒå¤šç«¯é€‚é…

### 2. API å±‚ (API Layer)

**èŒè´£**: æä¾› RESTful API æ¥å£

```typescript
// è·¯ç”±ç»“æ„
src/routes/
â”œâ”€â”€ user.routes.ts          // ç”¨æˆ·ç›¸å…³
â”œâ”€â”€ product.routes.ts       // å•†å“ç›¸å…³
â”œâ”€â”€ cart.routes.ts          // è´­ç‰©è½¦
â”œâ”€â”€ order.routes.ts         // è®¢å•
â”œâ”€â”€ review.routes.ts        // è¯„è®º
â”œâ”€â”€ favorite.routes.ts      // æ”¶è—
â”œâ”€â”€ search.routes.ts        // æœç´¢
â”œâ”€â”€ browse.routes.ts        // æµè§ˆå†å²
â””â”€â”€ admin/                  // ç®¡ç†å‘˜è·¯ç”±
    â”œâ”€â”€ admin.routes.ts
    â”œâ”€â”€ admin-product.routes.ts
    â”œâ”€â”€ admin-order.routes.ts
    â””â”€â”€ admin-user.routes.ts
```

**ä¸­é—´ä»¶é“¾**:
```
Request â†’ CORS â†’ Helmet â†’ Compression â†’ Rate Limit â†’ Auth â†’ Controller â†’ Response
```

### 3. ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)

**èŒè´£**: å¤„ç†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®éªŒè¯

```typescript
// æ§åˆ¶å™¨ç»“æ„
src/controllers/
â”œâ”€â”€ user.controller.ts      // ç”¨æˆ·ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ product.controller.ts   // å•†å“ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ cart.controller.ts      // è´­ç‰©è½¦ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ order.controller.ts     // è®¢å•ä¸šåŠ¡é€»è¾‘
â””â”€â”€ ...

// å…¸å‹æ§åˆ¶å™¨ç»“æ„
export async function createOrder(req: Request, res: Response) {
  try {
    // 1. å‚æ•°éªŒè¯
    const { address_id, items } = req.body;
    
    // 2. ä¸šåŠ¡é€»è¾‘
    const order = await orderModel.create({...});
    
    // 3. è¿”å›ç»“æœ
    return res.status(201).json({ order });
  } catch (error) {
    // 4. é”™è¯¯å¤„ç†
    return res.status(500).json({ error: error.message });
  }
}
```

### 4. æ•°æ®è®¿é—®å±‚ (Data Access Layer)

**èŒè´£**: æ•°æ®åº“æ“ä½œå’Œæ•°æ®æŒä¹…åŒ–

```typescript
// æ¨¡å‹ç»“æ„
src/models/
â”œâ”€â”€ user.model.ts           // ç”¨æˆ·æ•°æ®æ¨¡å‹
â”œâ”€â”€ product.model.ts        // å•†å“æ•°æ®æ¨¡å‹
â”œâ”€â”€ order.model.ts          // è®¢å•æ•°æ®æ¨¡å‹
â”œâ”€â”€ cart.model.ts           // è´­ç‰©è½¦æ•°æ®æ¨¡å‹
â””â”€â”€ ...

// å…¸å‹æ¨¡å‹æ–¹æ³•
export const productModel = {
  // æŸ¥è¯¢
  findById: async (id: number) => {...},
  findAll: async (filters: any) => {...},
  
  // åˆ›å»º
  create: async (data: any) => {...},
  
  // æ›´æ–°
  update: async (id: number, data: any) => {...},
  
  // åˆ é™¤
  delete: async (id: number) => {...}
};
```

### 5. æ•°æ®åº“å±‚ (Database Layer)

**èŒè´£**: æ•°æ®å­˜å‚¨å’Œç®¡ç†

```
MySQL (ä¸»æ•°æ®åº“)
â”œâ”€â”€ users                   // ç”¨æˆ·è¡¨
â”œâ”€â”€ products                // å•†å“è¡¨
â”œâ”€â”€ product_skus            // SKUè¡¨
â”œâ”€â”€ orders                  // è®¢å•è¡¨
â”œâ”€â”€ order_items             // è®¢å•è¯¦æƒ…è¡¨
â”œâ”€â”€ cart                    // è´­ç‰©è½¦è¡¨
â”œâ”€â”€ reviews                 // è¯„è®ºè¡¨
â”œâ”€â”€ favorites               // æ”¶è—è¡¨
â”œâ”€â”€ search_history          // æœç´¢å†å²è¡¨
â””â”€â”€ ...

Redis (ç¼“å­˜)
â”œâ”€â”€ product:hot             // çƒ­é—¨å•†å“
â”œâ”€â”€ product:{id}            // å•†å“è¯¦æƒ…
â”œâ”€â”€ user:session:{id}       // ç”¨æˆ·ä¼šè¯
â””â”€â”€ ...

MongoDB (æ—¥å¿—)
â”œâ”€â”€ browse_history          // æµè§ˆå†å²
â”œâ”€â”€ admin_logs              // ç®¡ç†å‘˜æ—¥å¿—
â””â”€â”€ ...
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### ER å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Users    â”‚         â”‚  Products   â”‚         â”‚   Orders    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚         â”‚ id (PK)     â”‚         â”‚ id (PK)     â”‚
â”‚ username    â”‚         â”‚ name        â”‚         â”‚ order_no    â”‚
â”‚ email       â”‚â—„â”€â”€â”€â”    â”‚ price       â”‚â—„â”€â”€â”€â”    â”‚ user_id (FK)â”‚
â”‚ password    â”‚    â”‚    â”‚ stock       â”‚    â”‚    â”‚ total_amountâ”‚
â”‚ phone       â”‚    â”‚    â”‚ category_id â”‚    â”‚    â”‚ status      â”‚
â”‚ created_at  â”‚    â”‚    â”‚ status      â”‚    â”‚    â”‚ created_at  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚            â”‚           â”‚            â”‚
                   â”‚            â”‚           â”‚            â”‚
                   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚    â”‚ Product_SKUs  â”‚   â”‚    â”‚ Order_Items   â”‚
                   â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                   â”‚    â”‚ id (PK)       â”‚   â”‚    â”‚ id (PK)       â”‚
                   â”‚    â”‚ product_id(FK)â”‚   â”‚    â”‚ order_id (FK) â”‚
                   â”‚    â”‚ sku_name      â”‚   â”‚    â”‚ product_id(FK)â”‚
                   â”‚    â”‚ price         â”‚   â”‚    â”‚ quantity      â”‚
                   â”‚    â”‚ stock         â”‚   â”‚    â”‚ price         â”‚
                   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                        â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
           â”‚     Cart       â”‚       â”‚  Favorites  â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚ id (PK)        â”‚       â”‚ id (PK)     â”‚
           â”‚ user_id (FK)   â”‚       â”‚ user_id (FK)â”‚
           â”‚ product_id (FK)â”‚       â”‚ product_id  â”‚
           â”‚ sku_id (FK)    â”‚       â”‚ created_at  â”‚
           â”‚ quantity       â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¡¨å…³ç³»è¯´æ˜

1. **ç”¨æˆ· â†’ è®¢å•**: ä¸€å¯¹å¤š (ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè®¢å•)
2. **ç”¨æˆ· â†’ è´­ç‰©è½¦**: ä¸€å¯¹å¤š (ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè´­ç‰©è½¦é¡¹)
3. **ç”¨æˆ· â†’ æ”¶è—**: ä¸€å¯¹å¤š (ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ”¶è—å¤šä¸ªå•†å“)
4. **å•†å“ â†’ SKU**: ä¸€å¯¹å¤š (ä¸€ä¸ªå•†å“å¯ä»¥æœ‰å¤šä¸ªSKU)
5. **è®¢å• â†’ è®¢å•é¡¹**: ä¸€å¯¹å¤š (ä¸€ä¸ªè®¢å•åŒ…å«å¤šä¸ªå•†å“)
6. **å•†å“ â†’ è¯„è®º**: ä¸€å¯¹å¤š (ä¸€ä¸ªå•†å“å¯ä»¥æœ‰å¤šä¸ªè¯„è®º)

### ç´¢å¼•ç­–ç•¥

```sql
-- ä¸»é”®ç´¢å¼•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
PRIMARY KEY (id)

-- å”¯ä¸€ç´¢å¼•
UNIQUE INDEX idx_email ON users(email)
UNIQUE INDEX idx_order_no ON orders(order_no)

-- æ™®é€šç´¢å¼•
INDEX idx_user_id ON orders(user_id)
INDEX idx_product_id ON order_items(product_id)
INDEX idx_category_id ON products(category_id)
INDEX idx_status ON orders(status)

-- å¤åˆç´¢å¼•
INDEX idx_user_product ON favorites(user_id, product_id)
INDEX idx_user_status ON orders(user_id, status)

-- å…¨æ–‡ç´¢å¼•
FULLTEXT INDEX idx_name ON products(name)
```

---

## ğŸ’¾ ç¼“å­˜ç­–ç•¥

### ç¼“å­˜æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  L1 ç¼“å­˜ (Redis)                         â”‚
â”‚  â€¢ çƒ­é—¨å•†å“ (10min TTL)                                  â”‚
â”‚  â€¢ å•†å“è¯¦æƒ… (5min TTL)                                   â”‚
â”‚  â€¢ ç”¨æˆ·ä¼šè¯ (7day TTL)                                   â”‚
â”‚  â€¢ åˆ†ç±»æ•°æ® (1hour TTL)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Cache Miss
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  L2 ç¼“å­˜ (Query Cache)                   â”‚
â”‚  â€¢ MySQL Query Cache                                     â”‚
â”‚  â€¢ åº”ç”¨å±‚æŸ¥è¯¢ç»“æœç¼“å­˜                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Cache Miss
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®åº“ (MySQL)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¼“å­˜é”®è®¾è®¡

```typescript
// ç¼“å­˜é”®å‘½åè§„èŒƒ
const CACHE_KEYS = {
  // å•†å“ç›¸å…³
  PRODUCT_DETAIL: (id: number) => `product:${id}`,
  PRODUCT_HOT: 'product:hot',
  PRODUCT_LIST: (page: number, limit: number) => `product:list:${page}:${limit}`,
  
  // ç”¨æˆ·ç›¸å…³
  USER_SESSION: (userId: number) => `user:session:${userId}`,
  USER_CART: (userId: number) => `user:cart:${userId}`,
  
  // åˆ†ç±»ç›¸å…³
  CATEGORIES: 'categories:all',
  CATEGORY_PRODUCTS: (catId: number) => `category:${catId}:products`
};

// TTL é…ç½®
const CACHE_TTL = {
  PRODUCT_HOT: 600,      // 10åˆ†é’Ÿ
  PRODUCT_DETAIL: 300,   // 5åˆ†é’Ÿ
  CATEGORIES: 3600,      // 1å°æ—¶
  USER_SESSION: 604800   // 7å¤©
};
```

### ç¼“å­˜æ›´æ–°ç­–ç•¥

```typescript
// 1. Cache Aside (æ—è·¯ç¼“å­˜)
async function getProduct(id: number) {
  // 1. å…ˆæŸ¥ç¼“å­˜
  const cached = await redis.get(CACHE_KEYS.PRODUCT_DETAIL(id));
  if (cached) return JSON.parse(cached);
  
  // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“
  const product = await db.query('SELECT * FROM products WHERE id = ?', [id]);
  
  // 3. å†™å…¥ç¼“å­˜
  await redis.setex(
    CACHE_KEYS.PRODUCT_DETAIL(id),
    CACHE_TTL.PRODUCT_DETAIL,
    JSON.stringify(product)
  );
  
  return product;
}

// 2. Write Through (å†™ç©¿)
async function updateProduct(id: number, data: any) {
  // 1. æ›´æ–°æ•°æ®åº“
  await db.query('UPDATE products SET ? WHERE id = ?', [data, id]);
  
  // 2. æ›´æ–°ç¼“å­˜
  const product = await db.query('SELECT * FROM products WHERE id = ?', [id]);
  await redis.setex(
    CACHE_KEYS.PRODUCT_DETAIL(id),
    CACHE_TTL.PRODUCT_DETAIL,
    JSON.stringify(product)
  );
}

// 3. Cache Invalidation (ç¼“å­˜å¤±æ•ˆ)
async function deleteProduct(id: number) {
  // 1. åˆ é™¤æ•°æ®åº“è®°å½•
  await db.query('DELETE FROM products WHERE id = ?', [id]);
  
  // 2. åˆ é™¤ç¼“å­˜
  await redis.del(CACHE_KEYS.PRODUCT_DETAIL(id));
  
  // 3. æ¸…é™¤ç›¸å…³ç¼“å­˜
  await redis.del('product:hot');
  await redis.del('product:list:*');
}
```

---

## ğŸ”Œ API è®¾è®¡

### RESTful è®¾è®¡åŸåˆ™

```
èµ„æºå‘½å:
GET    /api/products          # è·å–å•†å“åˆ—è¡¨
GET    /api/products/:id      # è·å–å•ä¸ªå•†å“
POST   /api/products          # åˆ›å»ºå•†å“
PUT    /api/products/:id      # æ›´æ–°å•†å“
DELETE /api/products/:id      # åˆ é™¤å•†å“

å­èµ„æº:
GET    /api/products/:id/skus      # è·å–å•†å“çš„SKUåˆ—è¡¨
POST   /api/products/:id/skus      # ä¸ºå•†å“æ·»åŠ SKU
GET    /api/products/:id/reviews   # è·å–å•†å“çš„è¯„è®º

æ“ä½œ:
POST   /api/orders/:id/pay         # æ”¯ä»˜è®¢å•
POST   /api/orders/:id/cancel      # å–æ¶ˆè®¢å•
POST   /api/orders/:id/confirm     # ç¡®è®¤æ”¶è´§
```

### ç»Ÿä¸€å“åº”æ ¼å¼

```typescript
// æˆåŠŸå“åº”
interface SuccessResponse<T> {
  success: true;
  data: T;
  message?: string;
}

// é”™è¯¯å“åº”
interface ErrorResponse {
  success: false;
  error: string;
  code: string;
  details?: any;
}

// åˆ†é¡µå“åº”
interface PaginatedResponse<T> {
  items: T[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
  };
}
```

### API ç‰ˆæœ¬æ§åˆ¶

```
å½“å‰ç‰ˆæœ¬: v1 (é»˜è®¤)
/api/products          # v1 (é»˜è®¤)
/api/v1/products       # v1 (æ˜¾å¼)
/api/v2/products       # v2 (æœªæ¥ç‰ˆæœ¬)
```

---

## ğŸ”’ å®‰å…¨æ¶æ„

### è®¤è¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚                                    â”‚  Server  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚                                              â”‚
      â”‚  1. POST /api/users/login                   â”‚
      â”‚  { email, password }                         â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                                              â”‚
      â”‚                           2. éªŒè¯ç”¨æˆ·åå¯†ç    â”‚
      â”‚                           3. ç”Ÿæˆ JWT Token  â”‚
      â”‚                                              â”‚
      â”‚  4. Response                                 â”‚
      â”‚  { token, user }                             â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                                              â”‚
      â”‚  5. å­˜å‚¨ Token (localStorage)                â”‚
      â”‚                                              â”‚
      â”‚  6. GET /api/products                        â”‚
      â”‚  Authorization: Bearer <token>               â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                                              â”‚
      â”‚                           7. éªŒè¯ Token      â”‚
      â”‚                           8. æå–ç”¨æˆ·ä¿¡æ¯     â”‚
      â”‚                           9. å¤„ç†è¯·æ±‚         â”‚
      â”‚                                              â”‚
      â”‚  10. Response                                â”‚
      â”‚  { products }                                â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

### JWT Token ç»“æ„

```typescript
// Token Payload
interface JWTPayload {
  userId: number;
  email: string;
  role: 'user' | 'admin';
  iat: number;  // issued at
  exp: number;  // expiration
}

// Token ç”Ÿæˆ
const token = jwt.sign(
  { userId: user.id, email: user.email, role: 'user' },
  process.env.JWT_SECRET,
  { expiresIn: '7d' }
);

// Token éªŒè¯
const decoded = jwt.verify(token, process.env.JWT_SECRET);
```

### å®‰å…¨æªæ–½

```typescript
// 1. å¯†ç åŠ å¯†
const hashedPassword = await bcrypt.hash(password, 10);

// 2. SQL æ³¨å…¥é˜²æŠ¤
const [users] = await pool.execute(
  'SELECT * FROM users WHERE email = ?',
  [email]
);

// 3. XSS é˜²æŠ¤
app.use(helmet());

// 4. CORS é…ç½®
app.use(cors({
  origin: process.env.CORS_ORIGIN,
  credentials: true
}));

// 5. é™æµ
const limiter = rateLimit({
  windowMs: 60 * 1000,
  max: 100
});
app.use('/api/', limiter);

// 6. è¯·æ±‚ä½“å¤§å°é™åˆ¶
app.use(express.json({ limit: '10mb' }));
```

---

## ğŸ³ éƒ¨ç½²æ¶æ„

### Docker å®¹å™¨æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Docker Network                         â”‚
â”‚                  (ecommerce-network)                     â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Frontend   â”‚  â”‚   Backend    â”‚  â”‚    MySQL     â”‚  â”‚
â”‚  â”‚   (Next.js)  â”‚  â”‚  (Express)   â”‚  â”‚   (8.0)      â”‚  â”‚
â”‚  â”‚   Port 3000  â”‚  â”‚  Port 3001   â”‚  â”‚  Port 3306   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Redis     â”‚  â”‚   MongoDB    â”‚  â”‚Elasticsearch â”‚  â”‚
â”‚  â”‚    (7.x)     â”‚  â”‚    (7.x)     â”‚  â”‚   (8.11)     â”‚  â”‚
â”‚  â”‚  Port 6379   â”‚  â”‚  Port 27017  â”‚  â”‚  Port 9200   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚   RabbitMQ   â”‚                                       â”‚
â”‚  â”‚    (3.x)     â”‚                                       â”‚
â”‚  â”‚  Port 5672   â”‚                                       â”‚
â”‚  â”‚  Port 15672  â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”Ÿäº§ç¯å¢ƒæ¶æ„

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ç”¨æˆ·è¯·æ±‚    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   CDN/DNS    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Load Balancerâ”‚
                    â”‚   (Nginx)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚Frontend â”‚      â”‚Frontend â”‚      â”‚Frontend â”‚
    â”‚Instance1â”‚      â”‚Instance2â”‚      â”‚Instance3â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                 â”‚                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ API Gateway  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚Backend  â”‚      â”‚Backend  â”‚      â”‚Backend  â”‚
    â”‚Instance1â”‚      â”‚Instance2â”‚      â”‚Instance3â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                 â”‚                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ MySQL   â”‚      â”‚  Redis  â”‚      â”‚ MongoDB â”‚
    â”‚ Master  â”‚      â”‚ Cluster â”‚      â”‚ Replica â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   Set   â”‚
         â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ MySQL   â”‚
    â”‚ Slave   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•

```typescript
// 1. æ— çŠ¶æ€è®¾è®¡
// âŒ ä¸è¦åœ¨æœåŠ¡å™¨å†…å­˜ä¸­å­˜å‚¨çŠ¶æ€
let userSessions = {};  // é”™è¯¯

// âœ… ä½¿ç”¨ Redis å­˜å‚¨çŠ¶æ€
await redis.set(`session:${userId}`, JSON.stringify(session));

// 2. æ•°æ®åº“è¿æ¥æ± 
const pool = mysql.createPool({
  connectionLimit: 10,
  host: process.env.DB_HOST,
  // ...
});

// 3. è´Ÿè½½å‡è¡¡
// ä½¿ç”¨ Nginx æˆ–äº‘æœåŠ¡çš„è´Ÿè½½å‡è¡¡å™¨
```

### å‚ç›´æ‰©å±•

```yaml
# Docker Compose èµ„æºé™åˆ¶
services:
  backend:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
        reservations:
          cpus: '1'
          memory: 2G
```

### æ•°æ®åº“æ‰©å±•

```
è¯»å†™åˆ†ç¦»:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Master  â”‚ â† Write Operations
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ Replication
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚          â”‚          â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ Slave 1 â”‚â”‚ Slave 2â”‚â”‚ Slave 3â”‚ â† Read Operations
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ†åº“åˆ†è¡¨:
Users DB
â”œâ”€â”€ users_0 (id % 4 = 0)
â”œâ”€â”€ users_1 (id % 4 = 1)
â”œâ”€â”€ users_2 (id % 4 = 2)
â””â”€â”€ users_3 (id % 4 = 3)
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–

```typescript
// 1. ä»£ç åˆ†å‰²
const AdminDashboard = dynamic(() => import('./admin/dashboard'), {
  loading: () => <Loading />,
  ssr: false
});

// 2. å›¾ç‰‡ä¼˜åŒ–
import Image from 'next/image';
<Image
  src="/product.jpg"
  width={300}
  height={300}
  loading="lazy"
  alt="Product"
/>

// 3. ç¼“å­˜ç­–ç•¥
export const revalidate = 60; // ISR: 60ç§’é‡æ–°éªŒè¯
```

### åç«¯ä¼˜åŒ–

```typescript
// 1. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
// âŒ N+1 æŸ¥è¯¢é—®é¢˜
for (const order of orders) {
  const items = await db.query('SELECT * FROM order_items WHERE order_id = ?', [order.id]);
}

// âœ… ä½¿ç”¨ JOIN
const orders = await db.query(`
  SELECT o.*, oi.*
  FROM orders o
  LEFT JOIN order_items oi ON o.id = oi.order_id
  WHERE o.user_id = ?
`, [userId]);

// 2. æ‰¹é‡æ“ä½œ
// âŒ å¾ªç¯æ’å…¥
for (const item of items) {
  await db.query('INSERT INTO cart ...', [item]);
}

// âœ… æ‰¹é‡æ’å…¥
await db.query('INSERT INTO cart VALUES ?', [items.map(i => [i.user_id, i.product_id])]);

// 3. å¼‚æ­¥å¤„ç†
// å‘é€é‚®ä»¶ç­‰è€—æ—¶æ“ä½œæ”¾å…¥é˜Ÿåˆ—
await rabbitmq.sendToQueue('email', { type: 'order_confirmation', orderId });
```

### ç›‘æ§æŒ‡æ ‡

```typescript
// å…³é”®æ€§èƒ½æŒ‡æ ‡ (KPI)
const metrics = {
  // å“åº”æ—¶é—´
  apiResponseTime: '<100ms (P95)',
  pageLoadTime: '<2s',
  
  // ååé‡
  requestsPerSecond: '1000 RPS',
  
  // å¯ç”¨æ€§
  uptime: '99.9%',
  
  // é”™è¯¯ç‡
  errorRate: '<0.1%',
  
  // ç¼“å­˜å‘½ä¸­ç‡
  cacheHitRate: '>80%'
};
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API æ–‡æ¡£](./API.md)
- [éƒ¨ç½²æ–‡æ¡£](./DEPLOYMENT.md)
- [ç¯å¢ƒé…ç½®](./ENV_SETUP.md)
- [è´¡çŒ®æŒ‡å—](./CONTRIBUTING.md)

---

**ç»´æŠ¤è€…**: Full-Stack Development Team  
**æœ€åæ›´æ–°**: 2025å¹´10æœˆ31æ—¥  
**ç‰ˆæœ¬**: 2.0.0

