# 功能测试清单 | Test Checklist

**测试版本**: 2.1.0  
**测试日期**: __________  
**测试人员**: __________

---

## 📋 测试前准备

- [ ] 后端服务正常启动
- [ ] 数据库连接正常（MySQL + MongoDB + Redis）
- [ ] 测试用户账号已创建
- [ ] 测试商品数据已准备
- [ ] 日志系统正常工作

---

## 🧪 功能测试

### 1. 订单超时自动取消功能

#### 1.1 基础功能测试

- [ ] **创建待支付订单**
  - 操作: 创建订单但不支付
  - 预期: 订单状态为 `pending_payment`
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **查询剩余支付时间**
  - API: `GET /api/orders/:id/remaining-time`
  - 预期: 返回剩余分钟数和超时时间
  - 结果: ⬜ 通过 ⬜ 失败
  - 响应示例:
    ```json
    {
      "remaining_minutes": 25,
      "timeout_at": "2025-10-31T12:30:00.000Z"
    }
    ```

- [ ] **订单自动取消**
  - 操作: 等待30分钟或修改订单创建时间
  - 预期: 订单状态变为 `cancelled`
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **库存自动恢复**
  - 操作: 检查商品库存
  - 预期: 库存数量恢复到订单前
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **取消原因记录**
  - 操作: 查看订单详情
  - 预期: `cancel_reason` 为 "订单超时未支付，系统自动取消"
  - 结果: ⬜ 通过 ⬜ 失败

#### 1.2 边界情况测试

- [ ] **已支付订单不受影响**
  - 操作: 创建并支付订单，等待30分钟
  - 预期: 订单状态保持 `paid`
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **已取消订单不重复处理**
  - 操作: 手动取消订单后等待30分钟
  - 预期: 订单保持 `cancelled`，不重复处理
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **SKU库存恢复**
  - 操作: 创建包含SKU的订单，等待超时
  - 预期: SKU库存正确恢复
  - 结果: ⬜ 通过 ⬜ 失败

#### 1.3 日志和监控

- [ ] **定时任务日志**
  - 检查: 后端日志
  - 预期: 看到 "[订单超时检查] 定时任务已启动"
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **处理日志**
  - 检查: 后端日志
  - 预期: 看到 "[订单超时] 订单 XXX 已自动取消"
  - 结果: ⬜ 通过 ⬜ 失败

---

### 2. 商品推荐系统

#### 2.1 个性化推荐（需登录）

- [ ] **无浏览历史的推荐**
  - API: `GET /api/recommendations/personalized`
  - 操作: 新用户请求推荐
  - 预期: 返回各分类热门商品
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **记录浏览历史**
  - API: `POST /api/browse`
  - 操作: 浏览3-5个商品
  - 预期: 浏览记录成功保存到MongoDB
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **基于浏览历史的推荐**
  - API: `GET /api/recommendations/personalized`
  - 操作: 有浏览历史后请求推荐
  - 预期: 返回与浏览商品相关的商品
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **排除已浏览商品**
  - 检查: 推荐结果
  - 预期: 推荐列表不包含已浏览的商品
  - 结果: ⬜ 通过 ⬜ 失败

#### 2.2 相关商品推荐（无需登录）

- [ ] **同分类商品推荐**
  - API: `GET /api/recommendations/related/:productId`
  - 操作: 请求商品1的相关推荐
  - 预期: 返回同分类的其他商品
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **价格相近商品**
  - 检查: 推荐商品价格
  - 预期: 价格在±30%范围内
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **按销量排序**
  - 检查: 推荐结果顺序
  - 预期: 销量高的商品排在前面
  - 结果: ⬜ 通过 ⬜ 失败

#### 2.3 猜你喜欢（可选登录）

- [ ] **未登录用户**
  - API: `GET /api/recommendations/guess-you-like`
  - 操作: 不带token请求
  - 预期: 返回热门商品
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **已登录用户**
  - API: `GET /api/recommendations/guess-you-like`
  - 操作: 带token请求
  - 预期: 返回个性化推荐
  - 结果: ⬜ 通过 ⬜ 失败

#### 2.4 推荐质量测试

- [ ] **推荐相关性**
  - 检查: 推荐商品与用户兴趣的匹配度
  - 预期: 推荐商品与浏览历史相关
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **推荐多样性**
  - 检查: 推荐结果的分类分布
  - 预期: 不全是同一分类
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **库存过滤**
  - 检查: 推荐商品库存
  - 预期: 不推荐库存为0的商品
  - 结果: ⬜ 通过 ⬜ 失败

#### 2.5 性能测试

- [ ] **响应时间**
  - 测试: 多次请求推荐API
  - 预期: 响应时间 <200ms
  - 实际: ______ms
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **并发测试**
  - 测试: 10个并发请求
  - 预期: 所有请求成功返回
  - 结果: ⬜ 通过 ⬜ 失败

---

## 🔧 系统测试

### 3.1 数据库测试

- [ ] **订单表索引**
  - 检查: `SHOW INDEX FROM orders`
  - 预期: 存在 `idx_status_created` 索引
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **商品表索引**
  - 检查: `SHOW INDEX FROM products`
  - 预期: 存在 `idx_category_sales` 和 `idx_status_stock` 索引
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **MongoDB集合**
  - 检查: `db.browse_history.find().limit(1)`
  - 预期: 集合存在且有数据
  - 结果: ⬜ 通过 ⬜ 失败

### 3.2 错误处理

- [ ] **无效订单ID**
  - API: `GET /api/orders/99999/remaining-time`
  - 预期: 返回404或适当错误
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **无效商品ID**
  - API: `GET /api/recommendations/related/99999`
  - 预期: 返回空数组或适当错误
  - 结果: ⬜ 通过 ⬜ 失败

- [ ] **未授权访问**
  - API: `GET /api/recommendations/personalized`（不带token）
  - 预期: 返回401未授权
  - 结果: ⬜ 通过 ⬜ 失败

---

## 📊 性能指标

### 订单超时服务

| 指标 | 目标值 | 实际值 | 状态 |
|------|--------|--------|------|
| 检查频率 | 5分钟 | _____ | ⬜ |
| 单订单处理时间 | <100ms | _____ms | ⬜ |
| CPU占用 | <5% | _____% | ⬜ |
| 内存占用 | <50MB | _____MB | ⬜ |

### 推荐服务

| 指标 | 目标值 | 实际值 | 状态 |
|------|--------|--------|------|
| 个性化推荐响应 | <200ms | _____ms | ⬜ |
| 相关商品响应 | <200ms | _____ms | ⬜ |
| 猜你喜欢响应 | <200ms | _____ms | ⬜ |
| 并发能力 | >100 QPS | _____ QPS | ⬜ |

---

## 🐛 问题记录

### 发现的问题

| 编号 | 问题描述 | 严重程度 | 状态 | 备注 |
|------|---------|---------|------|------|
| 1 | | ⬜ 高 ⬜ 中 ⬜ 低 | ⬜ 待修复 ⬜ 已修复 | |
| 2 | | ⬜ 高 ⬜ 中 ⬜ 低 | ⬜ 待修复 ⬜ 已修复 | |
| 3 | | ⬜ 高 ⬜ 中 ⬜ 低 | ⬜ 待修复 ⬜ 已修复 | |

---

## ✅ 测试总结

### 测试统计

- 总测试项: 40+
- 通过: _____
- 失败: _____
- 跳过: _____
- 通过率: _____%

### 测试结论

⬜ **通过** - 所有核心功能正常，可以部署  
⬜ **有问题** - 发现问题，需要修复  
⬜ **不通过** - 严重问题，不能部署

### 测试建议

1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

### 签名确认

- 测试人员: ____________  日期: __________
- 审核人员: ____________  日期: __________
- 批准部署: ⬜ 是 ⬜ 否

---

## 📚 参考文档

- [NEW_FEATURES_TEST.md](./NEW_FEATURES_TEST.md) - 详细测试说明
- [FEATURE_UPDATE_20251031.md](./FEATURE_UPDATE_20251031.md) - 功能更新说明
- [API.md](./API.md) - API文档

---

**最后更新**: 2025-10-31  
**文档版本**: 1.0

