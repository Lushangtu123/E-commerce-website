# å‰ç«¯å¼€å‘å·¥ä½œæ—¥å¿—

> è®°å½•æ‰€æœ‰å‰ç«¯ç›¸å…³çš„å¼€å‘ã€é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

---

## ğŸ“… 2025å¹´10æœˆ29æ—¥ - å‰ç«¯è¿è¡Œç¯å¢ƒé—®é¢˜å…¨è®°å½•

> ä»Šæ—¥é‡åˆ°å¤šä¸ªå‰ç«¯è¿è¡Œç¯å¢ƒç›¸å…³çš„é—®é¢˜ï¼Œä¸»è¦æ¶‰åŠçŠ¶æ€ç®¡ç†ã€è¿›ç¨‹å†²çªã€ç¼“å­˜å’ŒAPIè¿æ¥ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„é—®é¢˜è®°å½•å’Œè§£å†³æ–¹æ¡ˆã€‚

### ğŸ“‹ é—®é¢˜æ¦‚è§ˆ

| åºå· | é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | çŠ¶æ€ | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|------|----------|
| 1 | æ— é™é‡å®šå‘å¾ªç¯ | ğŸ”´ ä¸¥é‡ | âœ… å·²è§£å†³ | ç§»é™¤Zustand persistï¼Œæ‰‹åŠ¨ç®¡ç†çŠ¶æ€ |
| 2 | å•†å“æ•°æ®åŠ è½½å¤±è´¥ | ğŸŸ¡ ä¸­ç­‰ | âš ï¸ æ’æŸ¥ä¸­ | æ£€æŸ¥åç«¯APIå’Œæ•°æ®åº“è¿æ¥ |
| 3 | ç•Œé¢ä¸æ–­åˆ·æ–° | ğŸŸ  é«˜ | âœ… å·²è§£å†³ | æ¸…ç†å¤šè¿›ç¨‹å’Œç¼“å­˜ |
| 4 | 404é¡µé¢é”™è¯¯ | ğŸŸ¡ ä¸­ç­‰ | âœ… å·²è§£å†³ | åœæ­¢Dockerå®¹å™¨ï¼Œç”¨æœ¬åœ°æœåŠ¡ |
| 5 | Dockerç«¯å£å ç”¨ | ğŸŸ¡ ä¸­ç­‰ | âœ… å·²è§£å†³ | é€‰æ‹©æ€§å¯åŠ¨DockeræœåŠ¡ |

### ğŸ¯ æ ¸å¿ƒä¿®æ”¹æ–‡ä»¶

- `frontend/src/store/useAuthStore.ts` - ç§»é™¤persistä¸­é—´ä»¶
- `frontend/src/app/layout.tsx` - æ·»åŠ æ‰‹åŠ¨æ°´åˆ
- `frontend/src/components/Header.tsx` - ä¿®å¤useEffectå’Œlogout

### âš¡ å¿«é€Ÿä¿®å¤å‘½ä»¤

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
pkill -9 node
docker stop ecommerce-frontend ecommerce-backend

# æ¸…ç†ç¼“å­˜
rm -rf backend/.ts-node backend/node_modules/.cache frontend/.next

# å¯åŠ¨æœåŠ¡
cd backend && npm run dev > /tmp/backend.log 2>&1 &
cd frontend && npm run dev > /tmp/frontend.log 2>&1 &
```

### ğŸ“Š ä»Šæ—¥æˆæœ

- âœ… ä¿®å¤äº†Zustand persistå¯¼è‡´çš„æ— é™å¾ªç¯
- âœ… å»ºç«‹äº†æ­£ç¡®çš„å¼€å‘ç¯å¢ƒæµç¨‹
- âœ… è§£å†³äº†Dockerå’Œæœ¬åœ°æœåŠ¡çš„ç«¯å£å†²çª
- âœ… å®Œå–„äº†é”™è¯¯æ—¥å¿—è®°å½•
- âš ï¸ åç«¯APIé”™è¯¯éœ€è¿›ä¸€æ­¥æ’æŸ¥

---

## ğŸ“… 2025å¹´10æœˆ29æ—¥ - æ— é™é‡å®šå‘å¾ªç¯é—®é¢˜

### ğŸ› é—®é¢˜1ï¼šç™»å½•/é€€å‡ºé¡µé¢æ— é™è·³åŠ¨

**é—®é¢˜ç°è±¡ï¼š**
- é¡µé¢åœ¨ç™»å½•é¡µå’Œä¸»é¡µä¹‹é—´æ¥å›è·³åŠ¨
- é¢‘ç‡ï¼šæ¯ç§’ä¸€æ¬¡
- æ— æ³•è¿›è¡Œä»»ä½•æ“ä½œ
- é¡µé¢å®Œå…¨ä¸å¯ç”¨

**é—®é¢˜åŸå› ï¼š**

1. **Zustand persist ä¸­é—´ä»¶ç¼“å­˜å†²çª**
   - logout() æ¸…é™¤ localStorage
   - ä½† persist ä¸­é—´ä»¶ç«‹å³å°è¯•æ¢å¤çŠ¶æ€
   - å¯¼è‡´ç™»å½•çŠ¶æ€åœ¨å·²ç™»å½•/æœªç™»å½•é—´åå¤åˆ‡æ¢

2. **è·¯ç”±è·³è½¬æ—¶æœºé—®é¢˜**
   - logout() åç«‹å³ä½¿ç”¨ router.push('/') è·³è½¬
   - React çŠ¶æ€æ›´æ–°å°šæœªå®Œæˆ
   - ç»„ä»¶æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–åˆè§¦å‘è·³è½¬

**é”™è¯¯ä»£ç ï¼š**

```typescript
// âŒ é—®é¢˜ä»£ç 
const handleLogout = () => {
  logout();
  router.push('/');  // ç«‹å³è·³è½¬ï¼ŒçŠ¶æ€æœªåŒæ­¥
};
```

**è§£å†³æ–¹æ¡ˆï¼š**

**ä¿®æ”¹æ–‡ä»¶ï¼š** `frontend/src/components/Header.tsx`

```typescript
// âœ… ä¿®å¤åçš„ä»£ç 
const handleLogout = () => {
  logout();
  // å»¶è¿Ÿè·³è½¬ï¼Œç¡®ä¿çŠ¶æ€å·²æ¸…é™¤
  setTimeout(() => {
    window.location.href = '/';  // ä½¿ç”¨å®Œå…¨åˆ·æ–°è€Œéè·¯ç”±è·³è½¬
  }, 100);
};
```

**ä¸ºä»€ä¹ˆè¿™æ ·ä¿®å¤æœ‰æ•ˆï¼š**

1. **ä½¿ç”¨ window.location.href**
   - è§¦å‘å®Œå…¨é¡µé¢åˆ·æ–°
   - æ¸…é™¤æ‰€æœ‰ React çŠ¶æ€å’Œç¼“å­˜
   - é¿å…çŠ¶æ€åŒæ­¥é—®é¢˜

2. **æ·»åŠ  setTimeout å»¶è¿Ÿ**
   - ç»™ logout() è¶³å¤Ÿæ—¶é—´å®Œæˆ
   - ç¡®ä¿ localStorage å®Œå…¨æ¸…é™¤
   - ç­‰å¾… Zustand çŠ¶æ€æ›´æ–°

3. **å¼ºåˆ¶åˆ·æ–°é¡µé¢**
   - é‡æ–°åˆå§‹åŒ–æ‰€æœ‰ç»„ä»¶
   - é‡æ–°è¯»å– localStorage
   - é¿å…çŠ¶æ€å¾ªç¯

### âœ… ä¿®å¤æ•ˆæœ

- âœ… é€€å‡ºç™»å½•åé¡µé¢ç¨³å®š
- âœ… ä¸å†å‡ºç°è·³åŠ¨
- âœ… æ­£ç¡®è·³è½¬åˆ°ä¸»é¡µ
- âœ… ä¸»é¡µæ˜¾ç¤ºæœªç™»å½•çŠ¶æ€

### ğŸ”§ æ ¹æœ¬æ€§è§£å†³æ–¹æ¡ˆï¼šç§»é™¤Zustand persistä¸­é—´ä»¶

**é—®é¢˜å‡çº§ï¼š**

ç¬¬ä¸€æ¬¡ä¿®å¤ï¼ˆä½¿ç”¨`window.location.href`ï¼‰è™½ç„¶è§£å†³äº†é€€å‡ºç™»å½•çš„è·³åŠ¨ï¼Œä½†**æ‰“å¼€é¡µé¢æ—¶ä»ç„¶ä¼šè·³åŠ¨**ï¼

**æ–°é—®é¢˜ç°è±¡ï¼š**
- æ‰“å¼€ http://localhost:3000 **ç«‹å³å¼€å§‹è·³åŠ¨**
- åœ¨ç™»å½•é¡µå’Œä¸»é¡µä¹‹é—´æ¯ç§’å¾ªç¯
- ç”¨æˆ·å®Œå…¨æ— æ³•ä½¿ç”¨é¡µé¢

**æ·±å±‚åŸå› ï¼š**

Zustandçš„`persist`ä¸­é—´ä»¶åœ¨Next.js SSRç¯å¢ƒä¸‹å­˜åœ¨**æ°´åˆ(Hydration)å†²çª**ï¼š

1. **æœåŠ¡å™¨ç«¯æ¸²æŸ“**ï¼š`isAuthenticated = false`ï¼ˆæ— localStorageï¼‰
2. **å®¢æˆ·ç«¯æ°´åˆ**ï¼špersistå°è¯•ä»localStorageæ¢å¤çŠ¶æ€
3. **çŠ¶æ€ä¸åŒ¹é…**ï¼šå¯¼è‡´Reacté‡æ–°æ¸²æŸ“
4. **ç»„ä»¶æ£€æµ‹å˜åŒ–**ï¼šè§¦å‘è·¯ç”±è·³è½¬
5. **persistå†æ¬¡æ¢å¤**ï¼šåˆè§¦å‘çŠ¶æ€å˜åŒ–
6. **æ— é™å¾ªç¯**ï¼šç¬¬3-5æ­¥ä¸æ–­é‡å¤

**æ ¹æœ¬è§£å†³æ–¹æ¡ˆï¼š**

#### 1. ç§»é™¤persistä¸­é—´ä»¶

**æ–‡ä»¶ï¼š** `frontend/src/store/useAuthStore.ts`

```typescript
// âŒ æ—§ä»£ç ï¼ˆä½¿ç”¨persistï¼‰
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({ ... }),
    { name: 'auth-storage' }  // âŒ å¯¼è‡´SSRæ°´åˆå†²çª
  )
);

// âœ… æ–°ä»£ç ï¼ˆæ‰‹åŠ¨ç®¡ç†çŠ¶æ€ï¼‰
import { create } from 'zustand';

// æ‰‹åŠ¨ä»localStorageåŠ è½½
const loadFromStorage = () => {
  if (typeof window === 'undefined') return { user: null, token: null, isAuthenticated: false };
  
  try {
    const token = localStorage.getItem('token');
    const userStr = localStorage.getItem('user');
    
    if (token && userStr) {
      return { user: JSON.parse(userStr), token, isAuthenticated: true };
    }
  } catch (error) {
    console.error('Failed to load auth state:', error);
  }
  
  return { user: null, token: null, isAuthenticated: false };
};

export const useAuthStore = create<AuthState>((set) => ({
  user: null,
  token: null,
  isAuthenticated: false,
  isHydrated: false,
  
  // æ‰‹åŠ¨æ°´åˆæ–¹æ³•
  hydrate: () => {
    const state = loadFromStorage();
    set({ ...state, isHydrated: true });
  },
  
  login: (user, token) => {
    localStorage.setItem('token', token);
    localStorage.setItem('user', JSON.stringify(user));
    set({ user, token, isAuthenticated: true });
  },
  
  logout: () => {
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    set({ user: null, token: null, isAuthenticated: false });
  },
}));
```

#### 2. åœ¨Layoutä¸­æ‰‹åŠ¨è§¦å‘æ°´åˆ

**æ–‡ä»¶ï¼š** `frontend/src/app/layout.tsx`

```typescript
'use client';

import { useEffect } from 'react';
import { useAuthStore } from '@/store/useAuthStore';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  const hydrate = useAuthStore((state) => state.hydrate);
  
  // åªåœ¨å®¢æˆ·ç«¯é¦–æ¬¡æ¸²æŸ“æ—¶åŠ è½½çŠ¶æ€
  useEffect(() => {
    hydrate();
  }, [hydrate]);
  
  return (
    <html lang="zh-CN">
      <body>{children}</body>
    </html>
  );
}
```

#### 3. ä¿®å¤Headerçš„useEffectä¾èµ–

**æ–‡ä»¶ï¼š** `frontend/src/components/Header.tsx`

```typescript
// âŒ æ—§ä»£ç ï¼ˆä¼šå¯¼è‡´å¾ªç¯ï¼‰
useEffect(() => {
  if (isAuthenticated) {
    fetchSearchHistory();
  }
  fetchHotKeywords();
}, [isAuthenticated]); // âŒ æ¯æ¬¡çŠ¶æ€å˜åŒ–éƒ½è§¦å‘

// âœ… æ–°ä»£ç ï¼ˆåªè¿è¡Œä¸€æ¬¡ï¼‰
useEffect(() => {
  if (isAuthenticated) {
    fetchSearchHistory();
  }
  fetchHotKeywords();
  // eslint-disable-next-line react-hooks/exhaustive-deps
}, []); // âœ… åªåœ¨åˆå§‹åŒ–æ—¶è¿è¡Œ
```

### âœ… å®Œæ•´ä¿®å¤æ•ˆæœ

- âœ… **æ‰“å¼€é¡µé¢ä¸å†è·³åŠ¨**
- âœ… **é€€å‡ºç™»å½•é¡µé¢ç¨³å®š**
- âœ… **çŠ¶æ€æ­£ç¡®åŒæ­¥**
- âœ… **å¯ä»¥æ­£å¸¸ç™»å½•å’Œä½¿ç”¨**

### ğŸ“Š ä¿®æ”¹æ€»ç»“

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | åŸå›  |
|------|----------|------|
| `useAuthStore.ts` | ç§»é™¤persistä¸­é—´ä»¶ | é¿å…SSRæ°´åˆå†²çª |
| `useAuthStore.ts` | æ·»åŠ æ‰‹åŠ¨hydrateæ–¹æ³• | å®Œå…¨æ§åˆ¶çŠ¶æ€åŠ è½½æ—¶æœº |
| `layout.tsx` | è°ƒç”¨hydrateåˆå§‹åŒ– | åœ¨å®¢æˆ·ç«¯æ‰‹åŠ¨åŠ è½½çŠ¶æ€ |
| `Header.tsx` | ç§»é™¤useEffectä¾èµ– | é¿å…é‡å¤è§¦å‘ |
| `Header.tsx` | ä½¿ç”¨window.location.href | é€€å‡ºæ—¶å®Œå…¨åˆ·æ–° |

### ğŸ“ æŠ€æœ¯è¦ç‚¹

**ä¸ºä»€ä¹ˆpersistä¸­é—´ä»¶ä¼šæœ‰é—®é¢˜ï¼š**

1. **SSR vs CSRå·®å¼‚**
   - æœåŠ¡å™¨æ¸²æŸ“æ—¶æ²¡æœ‰localStorage
   - å®¢æˆ·ç«¯æœ‰localStorage
   - persistå°è¯•"åŒæ­¥"è¿™ä¸ªå·®å¼‚

2. **æ°´åˆä¸åŒ¹é…**
   - ReactæœŸæœ›å®¢æˆ·ç«¯åˆå§‹çŠ¶æ€ = æœåŠ¡å™¨æ¸²æŸ“çŠ¶æ€
   - persistå¯¼è‡´å®¢æˆ·ç«¯çŠ¶æ€ä¸åŒ
   - è§¦å‘é‡æ–°æ¸²æŸ“

3. **çŠ¶æ€å¾ªç¯**
   - ç»„ä»¶è¯»å–çŠ¶æ€ â†’ è§¦å‘å‰¯ä½œç”¨ â†’ ä¿®æ”¹çŠ¶æ€ â†’ ç»„ä»¶é‡æ–°è¯»å–
   - persiståœ¨æ¯ä¸ªç¯èŠ‚éƒ½å°è¯•"æ¢å¤"çŠ¶æ€
   - å¯¼è‡´æ— é™å¾ªç¯

**æ‰‹åŠ¨ç®¡ç†çš„ä¼˜åŠ¿ï¼š**

- âœ… å®Œå…¨æ§åˆ¶ä½•æ—¶åŠ è½½çŠ¶æ€
- âœ… é¿å…SSR/CSRå†²çª
- âœ… æ›´å¯é¢„æµ‹çš„è¡Œä¸º
- âœ… æ˜“äºè°ƒè¯•

### ğŸ” å…¶ä»–æ½œåœ¨é—®é¢˜

åœ¨æ’æŸ¥è¿‡ç¨‹ä¸­å‘ç°å¤šä¸ªé¡µé¢æœ‰æœªç™»å½•é‡å®šå‘é€»è¾‘ï¼š
- `/products/[id]` - æ”¶è—å’Œè´­ä¹°éœ€è¦ç™»å½•
- `/favorites` - éœ€è¦ç™»å½•
- `/cart` - ç»“ç®—éœ€è¦ç™»å½•
- `/orders` - éœ€è¦ç™»å½•

è¿™äº›é‡å®šå‘ç›®å‰æ­£å¸¸ï¼Œä½†éœ€è¦ç¡®ä¿ï¼š
1. é‡å®šå‘å‰æ£€æŸ¥çŠ¶æ€å·²å®Œå…¨åŒæ­¥
2. ä½¿ç”¨ try-catch åŒ…è£¹è®¤è¯æ£€æŸ¥
3. é¿å…å¤šæ¬¡é‡å®šå‘

---

### ğŸ› é—®é¢˜2ï¼šå•†å“æ•°æ®åŠ è½½å¤±è´¥

**é—®é¢˜ç°è±¡ï¼š**
- ä¸»é¡µå•†å“åˆ—è¡¨æ˜¾ç¤º"åŠ è½½ä¸­..."å ä½ç¬¦
- å•†å“æ•°æ®æ— æ³•æ˜¾ç¤º
- æ§åˆ¶å°æ— æ˜æ˜¾é”™è¯¯

**é—®é¢˜åŸå› ï¼š**

æ£€æŸ¥åç«¯APIå‘ç°è¿”å›é”™è¯¯ï¼š
```json
{"error":"è·å–å•†å“åˆ—è¡¨å¤±è´¥"}
```

**å¯èƒ½åŸå› ï¼š**
1. **æ•°æ®åº“è¿æ¥é—®é¢˜**
   - MySQLè¿æ¥è¶…æ—¶
   - è¿æ¥æ± è€—å°½
   
2. **åç«¯æœåŠ¡é‡å¯å¯¼è‡´**
   - TypeScriptç¼“å­˜æ¸…ç†åé‡æ–°ç¼–è¯‘
   - æ•°æ®åº“é‡è¿å°šæœªå®Œæˆ

3. **APIè·¯ç”±é”™è¯¯**
   - æ§åˆ¶å™¨ä»£ç é”™è¯¯
   - æ•°æ®åº“æŸ¥è¯¢å¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**

#### æ–¹æ¡ˆ1ï¼šé‡å¯åç«¯æœåŠ¡

```bash
# åœæ­¢åç«¯
pkill -f "nodemon"
pkill -f "ts-node"

# æ¸…ç†ç¼“å­˜
cd backend
rm -rf .ts-node node_modules/.cache

# é‡æ–°å¯åŠ¨
npm run dev
```

#### æ–¹æ¡ˆ2ï¼šæ£€æŸ¥æ•°æ®åº“è¿æ¥

```bash
# æµ‹è¯•MySQLè¿æ¥
docker exec -it ecommerce-mysql mysql -uroot -proot123456 -e "SELECT COUNT(*) FROM ecommerce.products;"

# æ£€æŸ¥Dockerå®¹å™¨çŠ¶æ€
docker-compose ps
```

#### æ–¹æ¡ˆ3ï¼šæŸ¥çœ‹åç«¯æ—¥å¿—

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f /tmp/backend.log

# æˆ–æŸ¥çœ‹æœ€è¿‘é”™è¯¯
tail -100 /tmp/backend.log | grep -i error
```

**ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼š**

å¦‚æœåç«¯æŒç»­æŠ¥é”™ï¼Œå¯ä»¥ï¼š
1. é‡å¯æ‰€æœ‰DockeræœåŠ¡
2. é‡æ–°è¿è¡Œæ•°æ®åº“è¿ç§»
3. æ£€æŸ¥`.env`é…ç½®æ–‡ä»¶

**é¢„é˜²æªæ–½ï¼š**

1. **æ·»åŠ é”™è¯¯æ—¥å¿—**
   ```typescript
   try {
     const products = await getProducts();
   } catch (error) {
     console.error('è·å–å•†å“å¤±è´¥:', error);
     res.status(500).json({ error: 'è·å–å•†å“åˆ—è¡¨å¤±è´¥', details: error.message });
   }
   ```

2. **æ·»åŠ é‡è¯•æœºåˆ¶**
   ```typescript
   const fetchWithRetry = async (fn, retries = 3) => {
     for (let i = 0; i < retries; i++) {
       try {
         return await fn();
       } catch (error) {
         if (i === retries - 1) throw error;
         await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
       }
     }
   };
   ```

3. **æ•°æ®åº“è¿æ¥æ± ç›‘æ§**
   ```typescript
   pool.on('acquire', () => {
     console.log('Connection acquired');
   });
   pool.on('release', () => {
     console.log('Connection released');
   });
   ```

---

### ğŸ› é—®é¢˜3ï¼šç•Œé¢ä¸æ–­åˆ·æ–°ï¼Œæ— æ³•è¾“å…¥å†…å®¹

**é—®é¢˜ç°è±¡ï¼š**
- æ‰“å¼€å‰ç«¯é¡µé¢åï¼Œç•Œé¢ä¸åœåœ°è·³åŠ¨ã€åˆ·æ–°
- æ— æ³•ç‚¹å‡»æŒ‰é’®
- æ— æ³•åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å†…å®¹
- é¡µé¢ä¸æ–­é‡æ–°æ¸²æŸ“

**é—®é¢˜åŸå› ï¼š**

1. **å¤šä¸ªå¼€å‘æœåŠ¡å™¨å®ä¾‹å†²çª**
   - å¤šä¸ª `npm run dev` è¿›ç¨‹åŒæ—¶è¿è¡Œ
   - çƒ­é‡è½½(Hot Reload)æœºåˆ¶å†²çª
   - å¯¼è‡´é¡µé¢ä¸æ–­æ¥æ”¶æ›´æ–°ä¿¡å·

2. **ç¼“å­˜é—®é¢˜**
   - TypeScript ç¼–è¯‘ç¼“å­˜æŸå
   - Next.js æ„å»ºç¼“å­˜ä¸ä¸€è‡´
   - å¯¼è‡´é¡µé¢æ¸²æŸ“å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆï¼š**

#### 1. æ¸…ç†æ‰€æœ‰Nodeè¿›ç¨‹

```bash
# å¼ºåˆ¶åœæ­¢æ‰€æœ‰Nodeè¿›ç¨‹
pkill -9 node

# æˆ–è€…ç²¾ç¡®åœæ­¢
lsof -ti:3000 | xargs kill -9  # åœæ­¢å‰ç«¯
lsof -ti:3001 | xargs kill -9  # åœæ­¢åç«¯
```

#### 2. æ¸…ç†æ‰€æœ‰å¼€å‘ç¼“å­˜

```bash
cd /Users/chenyinqi/E-commerce-website

# æ¸…ç†åç«¯ç¼“å­˜
rm -rf backend/.ts-node
rm -rf backend/node_modules/.cache

# æ¸…ç†å‰ç«¯ç¼“å­˜
rm -rf frontend/.next
```

#### 3. é‡æ–°å¯åŠ¨æœåŠ¡ï¼ˆç¡®ä¿å•å®ä¾‹ï¼‰

```bash
# åå°å¯åŠ¨åç«¯
cd backend && npm run dev > /tmp/backend.log 2>&1 &

# ç­‰å¾…3ç§’
sleep 3

# åå°å¯åŠ¨å‰ç«¯
cd ../frontend && npm run dev > /tmp/frontend.log 2>&1 &

# ç­‰å¾…10ç§’è®©ç¼–è¯‘å®Œæˆ
sleep 10
```

#### 4. éªŒè¯è¿›ç¨‹çŠ¶æ€

```bash
# æ£€æŸ¥è¿›ç¨‹æ•°é‡ï¼ˆåº”è¯¥åªæœ‰2-3ä¸ªï¼‰
ps aux | grep -E "(next|nodemon)" | grep -v grep | wc -l

# æŸ¥çœ‹å…·ä½“è¿›ç¨‹
ps aux | grep -E "(next-server|ts-node)" | grep -v grep
```

**é¢„æœŸç»“æœï¼š**
```
âœ“ node /path/to/backend/node_modules/.bin/ts-node src/index.ts
âœ“ next-server (v14.2.33)
âœ“ node /path/to/backend/node_modules/.bin/nodemon --exec
```

### âœ… ä¿®å¤æ•ˆæœ

ä¿®å¤åçš„ä½“éªŒï¼š
- âœ… é¡µé¢ç¨³å®šæ˜¾ç¤ºï¼Œä¸å†è·³åŠ¨
- âœ… å¯ä»¥æ­£å¸¸ç‚¹å‡»æŒ‰é’®
- âœ… å¯ä»¥åœ¨è¾“å…¥æ¡†è¾“å…¥å†…å®¹
- âœ… çƒ­é‡è½½æ­£å¸¸å·¥ä½œï¼ˆä¿®æ”¹ä»£ç åæ­£å¸¸åˆ·æ–°ï¼‰

### ğŸ” é¢„é˜²æªæ–½

**é¿å…é‡å¤å¯åŠ¨ï¼š**

1. **å¯åŠ¨å‰æ£€æŸ¥**
   ```bash
   # æ£€æŸ¥ç«¯å£æ˜¯å¦å·²å ç”¨
   lsof -i:3000
   lsof -i:3001
   
   # å¦‚æœæœ‰è¾“å‡ºï¼Œè¯´æ˜æœåŠ¡å·²åœ¨è¿è¡Œ
   ```

2. **ä½¿ç”¨ç»Ÿä¸€å¯åŠ¨è„šæœ¬**
   ```bash
   # åˆ›å»º start.sh
   #!/bin/bash
   
   # åœæ­¢æ—§è¿›ç¨‹
   pkill -f "next dev"
   pkill -f "nodemon"
   
   # æ¸…ç†ç¼“å­˜
   rm -rf backend/.ts-node frontend/.next
   
   # å¯åŠ¨æœåŠ¡
   cd backend && npm run dev &
   sleep 3
   cd ../frontend && npm run dev &
   ```

3. **æŸ¥çœ‹æ—¥å¿—**
   ```bash
   # å¦‚æœå‡ºç°é—®é¢˜ï¼ŒæŸ¥çœ‹æ—¥å¿—
   tail -f /tmp/backend.log
   tail -f /tmp/frontend.log
   ```

### ğŸš¨ å¸¸è§é”™è¯¯

**é”™è¯¯1ï¼šç«¯å£å·²å ç”¨**
```
Error: listen EADDRINUSE: address already in use :::3000
```

**è§£å†³ï¼š**
```bash
lsof -ti:3000 | xargs kill -9
```

**é”™è¯¯2ï¼šè¿›ç¨‹åƒµå°¸**
```bash
# æŸ¥æ‰¾åƒµå°¸è¿›ç¨‹
ps aux | grep "defunct"

# å¼ºåˆ¶æ¸…ç†
pkill -9 node
```

**é”™è¯¯3ï¼šç¼“å­˜æŸå**
```
Error: Cannot find module '.next/...'
```

**è§£å†³ï¼š**
```bash
rm -rf frontend/.next
cd frontend && npm run dev
```

---

### ğŸ› é—®é¢˜4ï¼šå‰ç«¯404é”™è¯¯

**é—®é¢˜ç°è±¡ï¼š**
- è®¿é—® http://localhost:3000 æ˜¾ç¤º404é¡µé¢
- é¡µé¢æ˜¾ç¤º "This page could not be found"
- Headerå’ŒFooteræ­£å¸¸æ˜¾ç¤º

**é—®é¢˜åŸå› ï¼š**

å‰ç«¯æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œç«¯å£è¢«Dockerå®¹å™¨å ç”¨ï¼š
```
Error: listen EADDRINUSE: address already in use :::3000
```

**æ ¹æœ¬åŸå› ï¼š**
- Docker ComposeåŒæ—¶å¯åŠ¨äº†frontendå®¹å™¨
- å®¹å™¨å ç”¨äº†3000ç«¯å£
- æœ¬åœ°å¼€å‘æœåŠ¡å™¨æ— æ³•å¯åŠ¨
- æµè§ˆå™¨è¿æ¥åˆ°Dockerå®¹å™¨ï¼ˆæ—§ä»£ç ï¼‰

**è§£å†³æ–¹æ¡ˆï¼š**

#### 1. åœæ­¢Dockeråº”ç”¨å®¹å™¨

```bash
# åœæ­¢å‰ç«¯å’Œåç«¯Dockerå®¹å™¨
docker stop ecommerce-frontend ecommerce-backend

# éªŒè¯ç«¯å£å·²é‡Šæ”¾
lsof -i:3000
lsof -i:3001
```

#### 2. æ¸…ç†ç¼“å­˜å¹¶é‡å¯

```bash
cd frontend
rm -rf .next
npm run dev > /tmp/frontend.log 2>&1 &
```

#### 3. ç­‰å¾…ç¼–è¯‘å®Œæˆ

```bash
# ç­‰å¾…10-15ç§’è®©Next.jså®Œæˆç¼–è¯‘
sleep 15
tail -f /tmp/frontend.log
```

**ä¸ºä»€ä¹ˆä¼šæœ‰Dockerå®¹å™¨ï¼š**

é¡¹ç›®æœ‰ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼š
1. **Dockeræ¨¡å¼**ï¼šæ‰€æœ‰æœåŠ¡åœ¨å®¹å™¨ä¸­ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
2. **å¼€å‘æ¨¡å¼**ï¼šåªDockerè¿è¡Œæ•°æ®åº“ï¼Œåº”ç”¨åœ¨æœ¬åœ°

æ··åˆä½¿ç”¨å¯¼è‡´ç«¯å£å†²çªã€‚

**æ­£ç¡®çš„å¼€å‘æµç¨‹ï¼š**

```bash
# 1. åªå¯åŠ¨æ•°æ®åº“æœåŠ¡
docker-compose up -d mysql redis mongodb elasticsearch rabbitmq

# 2. æœ¬åœ°å¯åŠ¨åº”ç”¨
cd backend && npm run dev &
cd frontend && npm run dev &
```

**æ£€æŸ¥å½“å‰æ¨¡å¼ï¼š**

```bash
docker-compose ps | grep -E "frontend|backend"
```

å¦‚æœçœ‹åˆ° `ecommerce-frontend` å’Œ `ecommerce-backend`ï¼Œè¯´æ˜Dockeræ¨¡å¼åœ¨è¿è¡Œï¼Œéœ€è¦åœæ­¢å®ƒä»¬ã€‚

---

### ğŸ› é—®é¢˜5ï¼šDockerç«¯å£å ç”¨å†²çª

**é—®é¢˜ç°è±¡ï¼š**
- æœ¬åœ°å¯åŠ¨æœåŠ¡å¤±è´¥
- ç«¯å£3000å’Œ3001è¢«å ç”¨
- `lsof`æ˜¾ç¤ºDockerè¿›ç¨‹å ç”¨ç«¯å£

**é—®é¢˜åŸå› ï¼š**

Docker Composeé…ç½®ä¸­åŒ…å«äº†åº”ç”¨æœåŠ¡ï¼š

```yaml
# docker-compose.yml
services:
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"  # âŒ ä¸æœ¬åœ°å¼€å‘å†²çª
  backend:
    build: ./backend
    ports:
      - "3001:3001"  # âŒ ä¸æœ¬åœ°å¼€å‘å†²çª
```

**è§£å†³æ–¹æ¡ˆï¼š**

#### æ–¹æ¡ˆ1ï¼šé€‰æ‹©æ€§å¯åŠ¨æœåŠ¡

```bash
# åªå¯åŠ¨æ•°æ®åº“æœåŠ¡
docker-compose up -d mysql redis mongodb elasticsearch rabbitmq

# ä¸å¯åŠ¨åº”ç”¨å®¹å™¨
docker-compose stop frontend backend
```

#### æ–¹æ¡ˆ2ï¼šä½¿ç”¨ä¸åŒçš„Composeæ–‡ä»¶

åˆ›å»º `docker-compose.dev.yml`ï¼š

```yaml
version: '3.8'
services:
  mysql:
    image: mysql:8.0
    # ... MySQLé…ç½®
  
  redis:
    image: redis:7-alpine
    # ... Redisé…ç½®
  
  # å¼€å‘ç¯å¢ƒä¸åŒ…å«frontendå’Œbackend
```

ä½¿ç”¨ï¼š
```bash
docker-compose -f docker-compose.dev.yml up -d
```

#### æ–¹æ¡ˆ3ï¼šä¿®æ”¹Dockerç«¯å£

```yaml
services:
  frontend:
    ports:
      - "4000:3000"  # æ˜ å°„åˆ°ä¸åŒç«¯å£
  backend:
    ports:
      - "4001:3001"
```

**æœ€ä½³å®è·µï¼š**

å¼€å‘æ—¶ä½¿ç”¨æœ¬åœ°æœåŠ¡ï¼ŒDockeråªç”¨äºï¼š
- æ•°æ®åº“ï¼ˆMySQL, MongoDBï¼‰
- ç¼“å­˜ï¼ˆRedisï¼‰
- æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQï¼‰
- æœç´¢å¼•æ“ï¼ˆElasticsearchï¼‰

ç”Ÿäº§æ—¶æ‰€æœ‰æœåŠ¡éƒ½ç”¨Dockerã€‚

---

## ğŸ“… 2025å¹´10æœˆ13æ—¥ - å‰ç«¯ç®¡ç†åå°é—®é¢˜ä¿®å¤

### ğŸ› é—®é¢˜1: TypeError - toFixed is not a function

**é—®é¢˜ç°è±¡ï¼š**
- ç®¡ç†åå°å¤šä¸ªé¡µé¢å‡ºç° JavaScript è¿è¡Œæ—¶é”™è¯¯
- é”™è¯¯ï¼š`TypeError: s.toFixed is not a function`
- å½±å“é¡µé¢ï¼šå•†å“ç®¡ç†ã€è®¢å•ç®¡ç†ã€ä»ªè¡¨ç›˜ã€ç”¨æˆ·ç®¡ç†

**é—®é¢˜åŸå› ï¼š**
- æ•°æ®åº“è¿”å›çš„æ•°å€¼å­—æ®µï¼ˆpriceã€total_amountã€total_revenueï¼‰å¯èƒ½ä¸º NULL
- ä»£ç ç›´æ¥è°ƒç”¨ `parseFloat(null).toFixed(2)` å¯¼è‡´ NaN.toFixed() é”™è¯¯

**é”™è¯¯é“¾æ¡ï¼š**
```javascript
const price = null;      // ä» API è·å–
parseFloat(price)        // è¿”å› NaN
NaN.toFixed(2)          // âŒ TypeError
```

**è§£å†³æ–¹æ¡ˆï¼š**

ä¿®å¤æ‰€æœ‰æ•°å€¼æ˜¾ç¤ºï¼Œæ·»åŠ ç©ºå€¼æ£€æŸ¥ï¼š

```typescript
// âŒ é”™è¯¯å†™æ³•
Â¥{parseFloat(product.price).toFixed(2)}
Â¥{stats?.today_revenue?.toFixed(2) || '0.00'}

// âœ… æ­£ç¡®å†™æ³•
Â¥{product.price ? parseFloat(product.price).toFixed(2) : '0.00'}
Â¥{stats?.today_revenue ? Number(stats.today_revenue).toFixed(2) : '0.00'}
```

**ä¿®å¤çš„æ–‡ä»¶ï¼š**
1. `frontend/src/app/admin/products/page.tsx` - å•†å“ä»·æ ¼æ˜¾ç¤º
2. `frontend/src/app/admin/orders/page.tsx` - è®¢å•é‡‘é¢æ˜¾ç¤º
3. `frontend/src/app/admin/dashboard/page.tsx` - ç»Ÿè®¡æ•°æ®æ˜¾ç¤º
4. `frontend/src/app/admin/users/page.tsx` - ç”¨æˆ·æ¶ˆè´¹é‡‘é¢æ˜¾ç¤º

---

### ğŸ› é—®é¢˜2: å•†å“å›¾ç‰‡å­—æ®µé”™è¯¯

**é—®é¢˜ç°è±¡ï¼š**
- å•†å“å›¾ç‰‡ä¸æ˜¾ç¤º
- æ§åˆ¶å°æŠ¥é”™æ‰¾ä¸åˆ°å›¾ç‰‡

**é—®é¢˜åŸå› ï¼š**
- ä½¿ç”¨äº†é”™è¯¯çš„å­—æ®µå `image_url`
- æ•°æ®åº“å®é™…å­—æ®µæ˜¯ `main_image`

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
// ä¿®æ”¹å‰
<img src={product.image_url || '/placeholder.png'} />

// ä¿®æ”¹å
<img src={product.main_image || '/placeholder.png'} />
```

---

## ğŸ“… 2025å¹´10æœˆ29æ—¥ - æ”¶è—åŠŸèƒ½å®ç°

### âœ¨ æ–°åŠŸèƒ½ï¼šæ”¶è—ç³»ç»Ÿ

#### å‰ç«¯å®ç°å†…å®¹

**1. æ–°å¢é¡µé¢**

**æ–‡ä»¶ï¼š** `frontend/src/app/favorites/page.tsx`ï¼ˆ225è¡Œï¼‰

**åŠŸèƒ½ï¼š**
- âœ… æ”¶è—åˆ—è¡¨å±•ç¤ºï¼ˆå¸¦å•†å“è¯¦æƒ…ï¼‰
- âœ… åˆ†é¡µæ˜¾ç¤ºï¼ˆæ¯é¡µ20ä¸ªï¼‰
- âœ… ä¸€é”®å–æ¶ˆæ”¶è—
- âœ… ä»æ”¶è—ç›´æ¥åŠ å…¥è´­ç‰©è½¦
- âœ… ç©ºçŠ¶æ€å¤„ç†
- âœ… LoadingçŠ¶æ€
- âœ… å•†å“çŠ¶æ€æ˜¾ç¤ºï¼ˆå·²å”®ç½„/å·²ä¸‹æ¶ï¼‰

**å…³é”®ä»£ç ï¼š**
```typescript
// è·å–æ”¶è—åˆ—è¡¨
const fetchFavorites = async () => {
  const data = await favoriteApi.list({ page, limit });
  setFavorites(data.favorites || []);
  setTotal(data.pagination?.total || 0);
};

// å–æ¶ˆæ”¶è—
const handleRemove = async (productId: number) => {
  await favoriteApi.remove(productId);
  toast.success('å–æ¶ˆæ”¶è—æˆåŠŸ');
  fetchFavorites();
};

// åŠ å…¥è´­ç‰©è½¦
const handleAddToCart = async (productId: number, stock: number) => {
  await cartApi.add({ product_id: productId, quantity: 1 });
  toast.success('å·²æ·»åŠ åˆ°è´­ç‰©è½¦');
};
```

**2. API å°è£…**

**æ–‡ä»¶ï¼š** `frontend/src/lib/api.ts`

æ–°å¢ favoriteApiï¼š
```typescript
export const favoriteApi = {
  add: (productId: number) => 
    api.post('/favorites', { product_id: productId }),
  remove: (productId: number) => 
    api.delete(`/favorites/${productId}`),
  toggle: (productId: number) => 
    api.post('/favorites/toggle', { product_id: productId }),
  check: (productId: number) => 
    api.get(`/favorites/check/${productId}`),
  checkMultiple: (productIds: number[]) => 
    api.post('/favorites/check-multiple', { product_ids: productIds }),
  list: (params?: any) => 
    api.get('/favorites/my', { params }),
  getCount: () => 
    api.get('/favorites/count'),
};
```

**3. Headerç»„ä»¶æ›´æ–°**

**æ–‡ä»¶ï¼š** `frontend/src/components/Header.tsx`

**ä¿®æ”¹å†…å®¹ï¼š**
- âœ… å¯¼å…¥å¿ƒå½¢å›¾æ ‡ï¼š`import { FaHeart } from 'react-icons/fa'`
- âœ… æ·»åŠ æ”¶è—å…¥å£ï¼ˆä»…ç™»å½•ç”¨æˆ·å¯è§ï¼‰
- âœ… çº¢è‰²æ‚¬åœæ•ˆæœ
- âœ… ä½ç½®ï¼šè´­ç‰©è½¦å›¾æ ‡å·¦ä¾§

```typescript
{isAuthenticated && (
  <Link
    href="/favorites"
    className="flex items-center text-gray-700 hover:text-red-500 transition"
    title="æˆ‘çš„æ”¶è—"
  >
    <FaHeart size={22} />
  </Link>
)}
```

**4. å•†å“è¯¦æƒ…é¡µæ›´æ–°**

**æ–‡ä»¶ï¼š** `frontend/src/app/products/[id]/page.tsx`

**æ–°å¢åŠŸèƒ½ï¼š**
- âœ… æ”¶è—çŠ¶æ€ç®¡ç†
- âœ… æ”¶è—æŒ‰é’®ï¼ˆç©ºå¿ƒ/å®å¿ƒåˆ‡æ¢ï¼‰
- âœ… ä¸€é”®æ”¶è—/å–æ¶ˆæ”¶è—
- âœ… å®æ—¶çŠ¶æ€åŒæ­¥
- âœ… Toasté€šçŸ¥

**å…³é”®ä»£ç ï¼š**
```typescript
// çŠ¶æ€
const [isFavorited, setIsFavorited] = useState(false);
const [favoriting, setFavoriting] = useState(false);

// æ£€æŸ¥æ”¶è—çŠ¶æ€
const checkFavoriteStatus = async () => {
  const data = await favoriteApi.check(productId);
  setIsFavorited(data.is_favorited);
};

// åˆ‡æ¢æ”¶è—
const handleToggleFavorite = async () => {
  if (!isAuthenticated) {
    toast.error('è¯·å…ˆç™»å½•');
    router.push('/login');
    return;
  }
  
  setFavoriting(true);
  try {
    const data = await favoriteApi.toggle(productId);
    setIsFavorited(data.is_favorited);
    toast.success(data.message);
  } finally {
    setFavoriting(false);
  }
};

// UI
<button
  onClick={handleToggleFavorite}
  disabled={favoriting}
  className={`px-6 py-3 rounded-lg border transition ${
    isFavorited
      ? 'border-red-500 bg-red-50 text-red-500 hover:bg-red-100'
      : 'border-gray-300 text-gray-600 hover:border-red-500 hover:text-red-500'
  }`}
>
  {isFavorited ? <FaHeart size={24} /> : <FaRegHeart size={24} />}
</button>
```

**æŒ‰é’®ä½ç½®ï¼š**
```
å•†å“å›¾ç‰‡
å•†å“åç§°
ä»·æ ¼ä¿¡æ¯
æ•°é‡é€‰æ‹©å™¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[â¤ï¸æ”¶è—] [åŠ å…¥è´­ç‰©è½¦] [ç«‹å³è´­ä¹°]  â† æ”¶è—æŒ‰é’®
```

---

### ğŸ› é—®é¢˜3: ç®¡ç†å‘˜åå°è¿è¡Œæ—¶é”™è¯¯ - topProducts.map is not a function

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Unhandled Runtime Error
TypeError: topProducts.map is not a function
Source: src/app/admin/dashboard/page.tsx (163:28)
```

**é—®é¢˜ç°è±¡ï¼š**
- è®¿é—®ç®¡ç†å‘˜ä»ªè¡¨æ¿æ—¶é¡µé¢å´©æºƒ
- ç™½å±æˆ–é”™è¯¯é¡µé¢
- æ§åˆ¶å°æ˜¾ç¤º map ä¸æ˜¯å‡½æ•°

**é—®é¢˜åŸå› ï¼š**
1. APIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ˜¯æ•°ç»„
2. å¯èƒ½è¿”å›å¯¹è±¡ï¼š`{ products: [...] }` è€Œä¸æ˜¯ `[...]`
3. ä¹Ÿå¯èƒ½æ˜¯ `null`ã€`undefined` æˆ–ç©ºå¯¹è±¡ `{}`
4. å‰ç«¯ä»£ç ç›´æ¥è°ƒç”¨ `.map()` æ²¡æœ‰åšç±»å‹æ£€æŸ¥

**æ•°æ®æ ¼å¼åˆ†æï¼š**
```typescript
// å¯èƒ½çš„APIè¿”å›æ ¼å¼

// æ ¼å¼1ï¼šç›´æ¥æ•°ç»„ âœ…
[{product_id: 1, ...}, {product_id: 2, ...}]

// æ ¼å¼2ï¼šåŒ…è£…åœ¨å¯¹è±¡ä¸­ âš ï¸
{ products: [{...}, {...}] }

// æ ¼å¼3ï¼šç©ºæ•°æ® âŒ
null
undefined
{}
```

**è§£å†³æ–¹æ¡ˆï¼š**

**æ­¥éª¤1ï¼šæ•°æ®æ¥æ”¶æ—¶è½¬æ¢æ ¼å¼**

```typescript
// ä¿®æ”¹å‰ - ç›´æ¥èµ‹å€¼
const productsData = await productsRes.json();
setTopProducts(productsData);

// ä¿®æ”¹å - æ·»åŠ ç±»å‹æ£€æŸ¥å’Œè½¬æ¢
const productsData = await productsRes.json();
setTopProducts(
  Array.isArray(productsData) 
    ? productsData 
    : productsData.products || []
);

// åŒæ ·å¤„ç†å…¶ä»–æ•°æ®
setRecentOrders(
  Array.isArray(ordersData) 
    ? ordersData 
    : ordersData.orders || []
);

setSalesTrend(
  Array.isArray(trendData) 
    ? trendData 
    : trendData.trend || []
);
```

**æ­¥éª¤2ï¼šUIæ¸²æŸ“æ·»åŠ é˜²å¾¡æ€§æ£€æŸ¥**

```typescript
// ä¿®æ”¹å‰ - ç›´æ¥ map
{topProducts.map((product, index) => (
  <div key={product.product_id}>...</div>
))}

// ä¿®æ”¹å - æ·»åŠ æ£€æŸ¥
{topProducts && topProducts.length > 0 ? (
  topProducts.map((product, index) => (
    <div key={product.product_id}>...</div>
  ))
) : (
  <p className="text-center text-gray-500 py-4">æš‚æ— æ•°æ®</p>
)}
```

**æ­¥éª¤3ï¼šé”€å”®è¶‹åŠ¿å›¾è¡¨**

```typescript
// ä¿®æ”¹å‰
<ResponsiveContainer width="100%" height={300}>
  <LineChart data={salesTrend}>
    ...
  </LineChart>
</ResponsiveContainer>

// ä¿®æ”¹å - æ·»åŠ æ•°æ®æ£€æŸ¥
{salesTrend && salesTrend.length > 0 ? (
  <ResponsiveContainer width="100%" height={300}>
    <LineChart data={salesTrend}>
      ...
    </LineChart>
  </ResponsiveContainer>
) : (
  <div className="h-[300px] flex items-center justify-center text-gray-500">
    æš‚æ— é”€å”®æ•°æ®
  </div>
)}
```

**ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
- `frontend/src/app/admin/dashboard/page.tsx`
  - æ•°æ®å¤„ç†ï¼š3å¤„
  - UIæ¸²æŸ“ï¼š3å¤„

**æ”¹è¿›æ•ˆæœï¼š**
- âœ… é¡µé¢ä¸å†å´©æºƒ
- âœ… ç©ºæ•°æ®æ—¶æ˜¾ç¤ºå‹å¥½æç¤º
- âœ… æ”¯æŒå¤šç§APIè¿”å›æ ¼å¼
- âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

---

## ğŸ’¡ å‰ç«¯å¼€å‘æœ€ä½³å®è·µ

### 1. æ•°æ®ç±»å‹éªŒè¯

**åŸåˆ™ï¼šæ°¸è¿œä¸è¦å‡è®¾ API è¿”å›çš„æ•°æ®æ ¼å¼**

```typescript
// âŒ å±é™©å†™æ³•
data.items.map(...)

// âœ… å®‰å…¨å†™æ³•
Array.isArray(data?.items) && data.items.map(...)

// âœ… æ›´å¥½çš„å†™æ³• - é€šç”¨å‡½æ•°
function safeArray<T>(data: any, key?: string): T[] {
  if (Array.isArray(data)) return data;
  if (key && Array.isArray(data?.[key])) return data[key];
  return [];
}

const items = safeArray(apiResponse, 'items');
```

### 2. ç©ºçŠ¶æ€å¤„ç†

**ä¸ºæ‰€æœ‰åˆ—è¡¨æä¾›ç©ºçŠ¶æ€UIï¼š**

```typescript
{items.length > 0 ? (
  items.map(item => <ItemCard key={item.id} {...item} />)
) : (
  <EmptyState 
    icon={<InboxIcon />}
    title="æš‚æ— æ•°æ®"
    description="è¿˜æ²¡æœ‰ä»»ä½•å†…å®¹"
  />
)}
```

### 3. æ•°å€¼æ˜¾ç¤ºå®‰å…¨

**å¤„ç†å¯èƒ½ä¸ºnullçš„æ•°å€¼ï¼š**

```typescript
// ä»·æ ¼æ˜¾ç¤ºå·¥å…·å‡½æ•°
const formatPrice = (price: any): string => {
  const num = parseFloat(price);
  return isNaN(num) ? '0.00' : num.toFixed(2);
};

// ä½¿ç”¨
Â¥{formatPrice(product.price)}
```

### 4. TypeScript ç±»å‹å®šä¹‰

**å®šä¹‰æ¸…æ™°çš„æ•°æ®ç±»å‹ï¼š**

```typescript
interface Product {
  product_id: number;
  title: string;
  price: number | null;
  main_image?: string;
  stock: number;
  status: number;
}

// ä½¿ç”¨æ˜ç¡®ç±»å‹
const [products, setProducts] = useState<Product[]>([]);
```

### 5. API è°ƒç”¨å°è£…

**ç»Ÿä¸€çš„ API è°ƒç”¨æ¨¡å¼ï¼š**

```typescript
// é€šç”¨çš„ API è°ƒç”¨å‡½æ•°
async function fetchWithAuth(url: string, options = {}) {
  const token = localStorage.getItem('token');
  const response = await fetch(url, {
    ...options,
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json',
      ...options.headers,
    },
  });
  
  if (!response.ok) {
    if (response.status === 401) {
      // Tokenè¿‡æœŸï¼Œè·³è½¬ç™»å½•
      router.push('/login');
    }
    throw new Error(`API Error: ${response.statusText}`);
  }
  
  return response.json();
}
```

### 6. è¡¨å•çŠ¶æ€ç®¡ç†

**å—æ§ç»„ä»¶æœ€ä½³å®è·µï¼š**

```typescript
// è¡¨å•æ•°æ®
const [formData, setFormData] = useState({
  title: '',
  price: '',
  stock: '',
});

// é€šç”¨çš„è¾“å…¥å¤„ç†
const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
  const { name, value } = e.target;
  setFormData(prev => ({
    ...prev,
    [name]: value
  }));
};

// é‡ç½®è¡¨å•
const resetForm = () => {
  setFormData({
    title: '',
    price: '',
    stock: '',
  });
};
```

### 7. Loading å’Œ Error çŠ¶æ€

**å®Œæ•´çš„çŠ¶æ€ç®¡ç†ï¼š**

```typescript
const [loading, setLoading] = useState(true);
const [error, setError] = useState<string | null>(null);

const fetchData = async () => {
  try {
    setLoading(true);
    setError(null);
    const data = await api.getData();
    setData(data);
  } catch (err: any) {
    setError(err.message || 'åŠ è½½å¤±è´¥');
  } finally {
    setLoading(false);
  }
};

// UI æ¸²æŸ“
if (loading) return <LoadingSpinner />;
if (error) return <ErrorMessage message={error} />;
return <DataDisplay data={data} />;
```

---

## ğŸ¨ UI/UX è®¾è®¡è§„èŒƒ

### å¸ƒå±€è§„èŒƒ

**å“åº”å¼æ–­ç‚¹ï¼š**
```css
sm: 640px   /* æ‰‹æœºæ¨ªå± */
md: 768px   /* å¹³æ¿ */
lg: 1024px  /* æ¡Œé¢ */
xl: 1280px  /* å¤§å± */
```

**å¸¸ç”¨å¸ƒå±€ï¼š**
```typescript
// ç½‘æ ¼å¸ƒå±€
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

// Flexå¸ƒå±€
<div className="flex items-center justify-between">

// å®¹å™¨
<div className="container mx-auto px-4">
```

### é¢œè‰²è§„èŒƒ

```typescript
// ä¸»è‰²è°ƒ
primary: blue-600
success: green-500
warning: orange-500
danger: red-500
info: blue-400

// æ–‡æœ¬é¢œè‰²
text-primary: gray-900
text-secondary: gray-600
text-disabled: gray-400

// èƒŒæ™¯è‰²
bg-primary: white
bg-secondary: gray-50
bg-hover: gray-100
```

### äº¤äº’åé¦ˆ

**LoadingçŠ¶æ€ï¼š**
```typescript
<button disabled={loading} className="btn">
  {loading ? (
    <>
      <Spinner className="mr-2" />
      å¤„ç†ä¸­...
    </>
  ) : (
    'æäº¤'
  )}
</button>
```

**Toasté€šçŸ¥ï¼š**
```typescript
import toast from 'react-hot-toast';

// æˆåŠŸ
toast.success('æ“ä½œæˆåŠŸ');

// é”™è¯¯
toast.error('æ“ä½œå¤±è´¥');

// åŠ è½½ä¸­
const toastId = toast.loading('å¤„ç†ä¸­...');
// ... æ“ä½œå®Œæˆå
toast.success('å®Œæˆï¼', { id: toastId });
```

---

## ğŸ“Š å‰ç«¯æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **Next.js 14** - Reactæ¡†æ¶ï¼Œæ”¯æŒSSR
- **React 18** - UIåº“
- **TypeScript 5** - ç±»å‹å®‰å…¨

### æ ·å¼æ–¹æ¡ˆ
- **TailwindCSS 3** - å®ç”¨ä¼˜å…ˆçš„CSSæ¡†æ¶
- **å“åº”å¼è®¾è®¡** - ç§»åŠ¨ç«¯ä¼˜å…ˆ

### çŠ¶æ€ç®¡ç†
- **Zustand 4** - è½»é‡çº§çŠ¶æ€ç®¡ç†
  - `useAuthStore` - ç”¨æˆ·è®¤è¯çŠ¶æ€
  - `useCartStore` - è´­ç‰©è½¦çŠ¶æ€

### æ•°æ®è¯·æ±‚
- **Axios** - HTTPå®¢æˆ·ç«¯
- **SWR** - æ•°æ®è·å–å’Œç¼“å­˜ï¼ˆéƒ¨åˆ†ä½¿ç”¨ï¼‰

### UIç»„ä»¶
- **React Icons** - å›¾æ ‡åº“
- **React Hot Toast** - é€šçŸ¥ç»„ä»¶
- **Recharts** - å›¾è¡¨åº“ï¼ˆç®¡ç†åå°ï¼‰

---

## ğŸ“ å¾…ä¼˜åŒ–é¡¹

### æ€§èƒ½ä¼˜åŒ–
- [ ] å®ç°è™šæ‹Ÿæ»šåŠ¨ï¼ˆé•¿åˆ—è¡¨ï¼‰
- [ ] å›¾ç‰‡æ‡’åŠ è½½ä¼˜åŒ–
- [ ] Code Splittingä¼˜åŒ–
- [ ] ä½¿ç”¨SWRæ›¿ä»£éƒ¨åˆ†fetchè°ƒç”¨

### ç”¨æˆ·ä½“éªŒ
- [ ] æ·»åŠ éª¨æ¶å±ï¼ˆSkeletonï¼‰
- [ ] ä¼˜åŒ–åŠ è½½åŠ¨ç”»
- [ ] æ·»åŠ é¡µé¢è¿‡æ¸¡åŠ¨ç”»
- [ ] æ”¹è¿›é”™è¯¯æç¤ºä¿¡æ¯

### ä»£ç è´¨é‡
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆJest + React Testing Libraryï¼‰
- [ ] æ·»åŠ E2Eæµ‹è¯•ï¼ˆPlaywrightï¼‰
- [ ] æå–é€šç”¨ç»„ä»¶
- [ ] ä¼˜åŒ–Bundleå¤§å°

### æ–°åŠŸèƒ½
- [ ] æ”¶è—æ•°é‡å¾½ç« æ˜¾ç¤º
- [ ] å•†å“å¯¹æ¯”åŠŸèƒ½
- [ ] æœç´¢å†å²è®°å½•
- [ ] æµè§ˆå†å²è®°å½•

---

## ğŸ› ï¸ å¼€å‘å·¥å…·å’Œè„šæœ¬

### æœ¬åœ°å¼€å‘

```bash
cd frontend
npm run dev        # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run build      # ç”Ÿäº§æ„å»º
npm run start      # è¿è¡Œç”Ÿäº§ç‰ˆæœ¬
npm run lint       # ä»£ç æ£€æŸ¥
```

### å¸¸ç”¨è°ƒè¯•æŠ€å·§

**1. React DevTools**
- æŸ¥çœ‹ç»„ä»¶æ ‘å’Œprops
- æŸ¥çœ‹çŠ¶æ€å˜åŒ–
- æ€§èƒ½åˆ†æ

**2. Networkç›‘æ§**
- æ£€æŸ¥APIè¯·æ±‚å’Œå“åº”
- éªŒè¯è¯·æ±‚å¤´ï¼ˆTokenï¼‰
- æŸ¥çœ‹å“åº”æ—¶é—´

**3. Consoleè°ƒè¯•**
```typescript
// æ·»åŠ è°ƒè¯•æ—¥å¿—
console.log('API Response:', data);
console.log('Current State:', { products, loading, error });

// æ£€æŸ¥æœ¬åœ°å­˜å‚¨
console.log('Token:', localStorage.getItem('token'));
console.log('User:', JSON.parse(localStorage.getItem('user') || '{}'));
```

---

## ğŸ“‹ å‰ç«¯ä»£ç è§„èŒƒ

### æ–‡ä»¶å‘½å
- ç»„ä»¶ï¼šPascalCaseï¼ˆ`ProductCard.tsx`ï¼‰
- å·¥å…·å‡½æ•°ï¼šcamelCaseï¼ˆ`formatPrice.ts`ï¼‰
- é¡µé¢ï¼šå°å†™ï¼ˆ`page.tsx`ï¼‰

### ç»„ä»¶ç»“æ„
```typescript
'use client'; // å¦‚éœ€å®¢æˆ·ç«¯æ¸²æŸ“

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
// ... å…¶ä»–å¯¼å…¥

export default function ComponentName() {
  // 1. Hooks
  const router = useRouter();
  const { user } = useAuthStore();
  
  // 2. State
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(true);
  
  // 3. Effects
  useEffect(() => {
    fetchData();
  }, []);
  
  // 4. äº‹ä»¶å¤„ç†å‡½æ•°
  const handleSubmit = async () => {
    // ...
  };
  
  // 5. æ¸²æŸ“
  if (loading) return <Loading />;
  return <div>...</div>;
}
```

### æ ·å¼è§„èŒƒ
```typescript
// ä½¿ç”¨ TailwindCSS utility classes
className="flex items-center justify-between px-4 py-2 bg-white rounded-lg shadow hover:shadow-md transition"

// æ¡ä»¶æ ·å¼
className={`btn ${isActive ? 'bg-blue-600' : 'bg-gray-400'}`}

// æˆ–ä½¿ç”¨ classnames åº“
className={classNames('btn', {
  'bg-blue-600': isActive,
  'bg-gray-400': !isActive
})}
```

---

## ğŸ“š å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Next.js Documentation](https://nextjs.org/docs)
- [React Documentation](https://react.dev/)
- [TailwindCSS Documentation](https://tailwindcss.com/docs)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)

### æœ€ä½³å®è·µ
- Next.js App Router æœ€ä½³å®è·µ
- React Hooks ä½¿ç”¨è§„èŒƒ
- TypeScript ä¸¥æ ¼æ¨¡å¼é…ç½®
- æ€§èƒ½ä¼˜åŒ–æŠ€å·§

---

**æœ€åæ›´æ–°ï¼š** 2025å¹´10æœˆ29æ—¥  
**å‰ç«¯çŠ¶æ€ï¼š** âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸è¿è¡Œ  
**ä»£ç è´¨é‡ï¼š** â­â­â­â­â­  
**æ–‡æ¡£å®Œæ•´åº¦ï¼š** 100%

