# ç®¡ç†åå°å¼€å‘å·¥ä½œæ—¥å¿—

> è®°å½•æ‰€æœ‰ç®¡ç†åå°ç›¸å…³çš„å¼€å‘ã€é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

---

## ğŸ“… 2025å¹´10æœˆ8æ—¥ - ç®¡ç†åå°å¯åŠ¨é—®é¢˜ä¿®å¤

### ğŸ› é—®é¢˜1: å‰ç«¯SSRæ¸²æŸ“é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Application error: a client-side exception has occurred
TypeError: g.map is not a function
```

**é—®é¢˜ç°è±¡ï¼š**
- è®¿é—®ç®¡ç†åå°é¡µé¢å‡ºç°ç™½å±
- æ§åˆ¶å°æŠ¥é”™ map ä¸æ˜¯å‡½æ•°
- é¡µé¢æ— æ³•æ­£å¸¸æ¸²æŸ“

**é—®é¢˜åŸå› ï¼š**
1. `recharts` å›¾è¡¨åº“åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰æ—¶å­˜åœ¨å…¼å®¹æ€§é—®é¢˜
2. æ ¹å¸ƒå±€ä¸­çš„ Header å’Œ Footer åœ¨ç®¡ç†å‘˜é¡µé¢ä¹Ÿæ˜¾ç¤ºäº†
3. å¸ƒå±€å†²çªå¯¼è‡´æ¸²æŸ“å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆï¼š**

**ä¿®å¤1ï¼šä¿®æ”¹æ ¹å¸ƒå±€**

**æ–‡ä»¶ï¼š** `frontend/src/app/layout.tsx`

```typescript
// ä¿®æ”¹ä¸ºå®¢æˆ·ç«¯ç»„ä»¶
'use client';

import { usePathname } from 'next/navigation';
import Header from '@/components/Header';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  const pathname = usePathname();
  const isAdminRoute = pathname?.startsWith('/admin');
  
  return (
    <html lang="zh-CN">
      <body>
        {/* ç®¡ç†å‘˜è·¯ç”±ä¸æ˜¾ç¤ºä¸»ç«™ Header/Footer */}
        {!isAdminRoute && <Header />}
        <main>{children}</main>
        {!isAdminRoute && <Footer />}
      </body>
    </html>
  );
}
```

**ä¿®å¤2ï¼šåˆ›å»ºç‹¬ç«‹çš„ç®¡ç†å‘˜å¸ƒå±€**

**æ–‡ä»¶ï¼š** `frontend/src/app/admin/layout.tsx`

```typescript
export const metadata = {
  title: 'ç®¡ç†åå° - ç”µå•†å¹³å°',
  description: 'ç”µå•†å¹³å°ç®¡ç†ç³»ç»Ÿ',
};

export default function AdminLayout({ children }: { children: React.ReactNode }) {
  return children;  // ç®¡ç†å‘˜é¡µé¢ä½¿ç”¨è‡ªå·±çš„å¸ƒå±€ç»„ä»¶
}
```

**ä¿®å¤3ï¼šç®€åŒ– Recharts å¯¼å…¥**

**æ–‡ä»¶ï¼š** `frontend/src/app/admin/dashboard/page.tsx`

```typescript
// ç¡®ä¿æ˜¯å®¢æˆ·ç«¯ç»„ä»¶
'use client';

// ç›´æ¥å¯¼å…¥ï¼Œä¸è¦åŠ¨æ€å¯¼å…¥
import { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';
```

---

### ğŸ› é—®é¢˜2: åç«¯API 500é”™è¯¯

**é”™è¯¯æ—¥å¿—ï¼š**
```
Error: Unknown column 'p.image_url' in 'field list'
Error: Unknown column 'oi.order_item_id' in 'field list'
```

**é—®é¢˜åŸå› ï¼š**
æ•°æ®åº“å­—æ®µåä¸ä»£ç ä¸åŒ¹é…ï¼š
- products è¡¨ä½¿ç”¨ `main_image` è€Œé `image_url`
- order_items è¡¨ä½¿ç”¨ `item_id` è€Œé `order_item_id`

**è§£å†³æ–¹æ¡ˆï¼š**

**ä¿®å¤æ–‡ä»¶ï¼š**
1. `backend/src/controllers/admin.controller.ts`
   - `p.image_url` â†’ `p.main_image`
   - `oi.order_item_id` â†’ `oi.item_id`

2. `backend/src/controllers/admin-order.controller.ts`
   - `p.image_url` â†’ `p.main_image`

---

### ğŸ› é—®é¢˜3: Dockerå®¹å™¨ä»£ç æœªæ›´æ–°

**ç°è±¡ï¼š**
- æœ¬åœ°ç¼–è¯‘åç«¯ä»£ç 
- Docker å®¹å™¨ä»ç„¶è¿è¡Œæ—§ä»£ç 
- é”™è¯¯æŒç»­å‡ºç°

**åŸå› ï¼š**
Docker å®¹å™¨ä½¿ç”¨çš„æ˜¯é•œåƒä¸­çš„ä»£ç ï¼Œæœ¬åœ°ç¼–è¯‘ä¸ä¼šè‡ªåŠ¨åŒæ­¥ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

**å®Œæ•´æ›´æ–°æµç¨‹ï¼š**
```bash
# 1. ç¼–è¯‘ TypeScript
cd backend
npm run build

# 2. é‡æ–°æ„å»º Docker é•œåƒ
cd ..
docker-compose build backend

# 3. é‡å¯å®¹å™¨
docker-compose up -d backend

# 4. éªŒè¯
docker-compose logs --tail=20 backend
```

**å¼€å‘ç¯å¢ƒå»ºè®®ï¼š**
```bash
# ä½¿ç”¨æœ¬åœ°å¼€å‘æ¨¡å¼ï¼Œä¸ç”¨Dockerè¿è¡Œåº”ç”¨ä»£ç 
docker stop ecommerce-backend ecommerce-frontend

# åç«¯æœ¬åœ°è¿è¡Œ
cd backend && npm run dev

# å‰ç«¯æœ¬åœ°è¿è¡Œ
cd frontend && npm run dev
```

---

## ğŸ“… 2025å¹´10æœˆ13æ—¥ - å•†å“ç®¡ç†åŠŸèƒ½å®Œå–„

### ğŸ¯ ç®¡ç†åå°åŠŸèƒ½æ¶æ„

**é¡µé¢ç»“æ„ï¼š**
```
/admin
â”œâ”€â”€ /login          - ç®¡ç†å‘˜ç™»å½•
â”œâ”€â”€ /dashboard      - æ•°æ®ç»Ÿè®¡ä»ªè¡¨ç›˜
â”œâ”€â”€ /products       - å•†å“ç®¡ç†
â”œâ”€â”€ /orders         - è®¢å•ç®¡ç†
â”œâ”€â”€ /users          - ç”¨æˆ·ç®¡ç†
â””â”€â”€ /logs           - ç³»ç»Ÿæ—¥å¿—
```

**æƒé™æ§åˆ¶ï¼š**
- æ‰€æœ‰ç®¡ç†é¡µé¢éœ€è¦ç®¡ç†å‘˜ Token è®¤è¯
- Token å­˜å‚¨åœ¨ `localStorage.admin_token`
- ä½¿ç”¨ JWT éªŒè¯èº«ä»½

---

### ğŸ› ï¸ åŠŸèƒ½1: å•†å“ç®¡ç†æ¨¡å—

#### 1.1 å•†å“åˆ—è¡¨å±•ç¤º

**è·¯ç”±ï¼š** `/admin/products`

**åŠŸèƒ½æ¸…å•ï¼š**
- [x] å•†å“åˆ—è¡¨åˆ†é¡µæ˜¾ç¤º
- [x] æœç´¢å•†å“ï¼ˆå…³é”®è¯ï¼‰
- [x] ç­›é€‰å•†å“ï¼ˆçŠ¶æ€ï¼šå…¨éƒ¨/å·²ä¸Šæ¶/å·²ä¸‹æ¶ï¼‰
- [x] å•†å“ä¸Šæ¶/ä¸‹æ¶æ“ä½œ
- [x] æ‰¹é‡ä¸Šæ¶/ä¸‹æ¶
- [x] å•†å“é€‰æ‹©ï¼ˆå¤é€‰æ¡†ï¼‰
- [x] æ·»åŠ å•†å“åŠŸèƒ½
- [x] **SKUç®¡ç†åŠŸèƒ½**ï¼ˆ2025-10-29æ–°å¢ï¼‰

**æ•°æ®å­—æ®µï¼š**
| æ˜¾ç¤ºåˆ— | æ•°æ®æº | è¯´æ˜ |
|-------|-------|------|
| å•†å“å›¾ç‰‡ | product.main_image | ä¸»å›¾ç‰‡ |
| å•†å“æ ‡é¢˜ | product.title | å•†å“åç§° |
| åˆ†ç±» | product.category_name | æ¥è‡ª JOIN categories |
| ä»·æ ¼ | product.price | DECIMAL ç±»å‹ |
| åº“å­˜ | product.stock | INT ç±»å‹ |
| é”€é‡ | product.sales_count | INT ç±»å‹ |
| çŠ¶æ€ | product.status | 1:å·²ä¸Šæ¶, 0:å·²ä¸‹æ¶ |

**åç«¯APIï¼š**
```typescript
GET /api/admin/products
  - å‚æ•°ï¼špage, limit, keyword, categoryId, status
  - è¿”å›ï¼šå•†å“åˆ—è¡¨ + åˆ†é¡µä¿¡æ¯

PUT /api/admin/products/:productId/status
  - æ›´æ–°å•†å“ä¸Šä¸‹æ¶çŠ¶æ€

PUT /api/admin/products/batch/status
  - æ‰¹é‡æ›´æ–°å•†å“çŠ¶æ€

POST /api/admin/products
  - åˆ›å»ºæ–°å•†å“

PUT /api/admin/products/:productId
  - æ›´æ–°å•†å“ä¿¡æ¯

DELETE /api/admin/products/:productId
  - åˆ é™¤å•†å“ï¼ˆè½¯åˆ é™¤ï¼‰
```

#### 1.2 æ·»åŠ å•†å“åŠŸèƒ½

**UI è®¾è®¡ï¼š**
- ç‚¹å‡»"æ·»åŠ å•†å“"æŒ‰é’®å¼¹å‡ºæ¨¡æ€æ¡†
- æ¨¡æ€æ¡†åŒ…å«å®Œæ•´è¡¨å•
- æ”¯æŒå›¾ç‰‡ URL å®æ—¶é¢„è§ˆ
- è¡¨å•éªŒè¯ï¼ˆå¿…å¡«é¡¹ï¼‰

**è¡¨å•å­—æ®µï¼š**

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|-----|------|------|------|
| title | text | âœ… | å•†å“æ ‡é¢˜ |
| description | textarea | âŒ | å•†å“æè¿° |
| price | number | âœ… | ä»·æ ¼ï¼ˆå…ƒï¼‰ |
| stock | number | âŒ | åº“å­˜æ•°é‡ |
| category_id | select | âœ… | å•†å“åˆ†ç±» |
| brand | text | âŒ | å“ç‰Œåç§° |
| main_image | text | âŒ | å›¾ç‰‡ URL |
| status | select | âŒ | çŠ¶æ€ï¼ˆä¸Šæ¶/ä¸‹æ¶ï¼‰ |

**å®ç°æµç¨‹ï¼š**
```
ç‚¹å‡»æ·»åŠ å•†å“ â†’ å¼¹å‡ºæ¨¡æ€æ¡† â†’ å¡«å†™è¡¨å• â†’ è¡¨å•éªŒè¯ â†’ 
æäº¤API â†’ æˆåŠŸ â†’ å…³é—­æ¨¡æ€æ¡† â†’ åˆ·æ–°åˆ—è¡¨ â†’ æ˜¾ç¤ºæˆåŠŸæç¤º
       â†“
     å¤±è´¥ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º
```

#### 1.3 SKUç®¡ç†åŠŸèƒ½ï¼ˆ2025-10-29æ–°å¢ï¼‰

**åç«¯APIï¼š**
```typescript
GET /api/admin/products/:productId/skus
  - è·å–å•†å“çš„æ‰€æœ‰SKU

POST /api/admin/products/:productId/skus
  - åˆ›å»ºå•ä¸ªSKU

POST /api/admin/products/:productId/skus/batch
  - æ‰¹é‡åˆ›å»ºSKU

PUT /api/admin/products/skus/:skuId
  - æ›´æ–°SKUä¿¡æ¯

DELETE /api/admin/products/skus/:skuId
  - åˆ é™¤SKU
```

**SKUæ•°æ®ç»“æ„ï¼š**
```typescript
interface ProductSKU {
  sku_id: number;
  product_id: number;
  sku_code: string;              // å”¯ä¸€ç¼–ç 
  specs: {                       // JSONæ ¼å¼
    color?: string;              // é¢œè‰²
    size?: string;               // å°ºå¯¸
    [key: string]: any;          // å…¶ä»–è§„æ ¼
  };
  price: number;
  original_price?: number;
  stock: number;
  image?: string;
  status: number;                // 1:å¯ç”¨ 0:ç¦ç”¨
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```typescript
// åˆ›å»ºSKU
POST /api/admin/products/1/skus
Body: {
  sku_code: "IPHONE-RED-128G",
  specs: {
    "é¢œè‰²": "çº¢è‰²",
    "å®¹é‡": "128GB"
  },
  price: 7999,
  original_price: 8999,
  stock: 100,
  image: "https://example.com/red.jpg"
}

// æ‰¹é‡åˆ›å»º
POST /api/admin/products/1/skus/batch
Body: {
  skus: [
    { sku_code: "IPHONE-RED-128G", specs: {...}, price: 7999, stock: 100 },
    { sku_code: "IPHONE-BLUE-256G", specs: {...}, price: 8999, stock: 50 }
  ]
}
```

---

### ğŸ“Š åŠŸèƒ½2: æ•°æ®ç»Ÿè®¡ä»ªè¡¨ç›˜

#### 2.1 ç»Ÿè®¡å¡ç‰‡

**è·¯ç”±ï¼š** `/admin/dashboard`

**æ˜¾ç¤ºæŒ‡æ ‡ï¼š**

| æŒ‡æ ‡ | API å­—æ®µ | è¯´æ˜ |
|-----|---------|------|
| ä»Šæ—¥è®¢å• | stats.today_orders | å½“æ—¥è®¢å•æ•°é‡ |
| ä»Šæ—¥é”€å”®é¢ | stats.today_revenue | å½“æ—¥é”€å”®æ€»é¢ |
| æ–°å¢ç”¨æˆ· | stats.new_users | æ–°æ³¨å†Œç”¨æˆ·æ•° |
| å•†å“æ€»æ•° | stats.total_products | åœ¨å”®å•†å“æ•°é‡ |

**åç«¯å®ç°ï¼š**

```typescript
// GET /api/admin/dashboard/stats
const stats = {
  today_orders: ...,      // ä»Šæ—¥è®¢å•æ•°
  today_revenue: ...,     // ä»Šæ—¥é”€å”®é¢
  new_users: ...,         // ä»Šæ—¥æ–°ç”¨æˆ·
  total_products: ...,    // å•†å“æ€»æ•°
};
```

**å¸¸è§é—®é¢˜ä¿®å¤ï¼š**
```typescript
// âŒ é—®é¢˜ï¼šstats å¯èƒ½ä¸ºnullå¯¼è‡´ toFixed é”™è¯¯
Â¥{stats?.today_revenue?.toFixed(2)}

// âœ… è§£å†³ï¼šæ·»åŠ ç©ºå€¼æ£€æŸ¥
Â¥{stats?.today_revenue ? Number(stats.today_revenue).toFixed(2) : '0.00'}
```

#### 2.2 é”€å”®è¶‹åŠ¿å›¾è¡¨

**æ•°æ®æºï¼š** æœ€è¿‘ 7 å¤©çš„é”€å”®æ•°æ®

**APIï¼š** `GET /api/admin/dashboard/sales-trend?days=7`

**åç«¯å®ç°ï¼š**
```typescript
const [salesTrend] = await pool.query(`
  SELECT 
    DATE(created_at) as date,
    COUNT(*) as order_count,
    SUM(total_amount) as revenue
  FROM orders
  WHERE created_at >= DATE_SUB(NOW(), INTERVAL ? DAY)
  GROUP BY DATE(created_at)
  ORDER BY date ASC
`, [days]);
```

**è¿”å›æ ¼å¼ï¼š**
```json
[
  { "date": "2025-10-23", "order_count": 15, "revenue": 12500.50 },
  { "date": "2025-10-24", "order_count": 20, "revenue": 15800.00 },
  ...
]
```

**å›¾è¡¨ç±»å‹ï¼š**
- æŠ˜çº¿å›¾ï¼šé”€å”®é¢è¶‹åŠ¿
- æŸ±çŠ¶å›¾ï¼šè®¢å•æ•°é‡

**Rechartsé…ç½®ï¼š**
```typescript
<LineChart data={salesTrend}>
  <CartesianGrid strokeDasharray="3 3" />
  <XAxis dataKey="date" />
  <YAxis />
  <Tooltip />
  <Legend />
  <Line type="monotone" dataKey="revenue" name="é”€å”®é¢" stroke="#3b82f6" />
  <Line type="monotone" dataKey="order_count" name="è®¢å•æ•°" stroke="#10b981" />
</LineChart>
```

#### 2.3 çƒ­é—¨å•†å“æ’è¡Œ

**APIï¼š** `GET /api/admin/dashboard/top-products?days=7&limit=5`

**åç«¯SQLï¼š**
```sql
SELECT 
  p.product_id,
  p.title,
  p.main_image,
  COUNT(oi.item_id) as total_sales,
  SUM(oi.price * oi.quantity) as total_revenue
FROM products p
LEFT JOIN order_items oi ON p.product_id = oi.product_id
LEFT JOIN orders o ON oi.order_id = o.order_id
WHERE o.created_at >= DATE_SUB(NOW(), INTERVAL ? DAY)
  AND o.status IN (1, 2, 3)
GROUP BY p.product_id
ORDER BY total_sales DESC
LIMIT ?
```

**2025-10-29ä¿®å¤ï¼š**

**é—®é¢˜ï¼š** `topProducts.map is not a function`

**åŸå› ï¼š** API è¿”å›æ ¼å¼å¯èƒ½ä¸æ˜¯æ•°ç»„

**è§£å†³ï¼š**
```typescript
// æ•°æ®æ¥æ”¶æ—¶è½¬æ¢
const productsData = await productsRes.json();
setTopProducts(
  Array.isArray(productsData) 
    ? productsData 
    : productsData.products || []
);

// UIæ¸²æŸ“æ—¶æ£€æŸ¥
{topProducts && topProducts.length > 0 ? (
  topProducts.map((product, index) => (
    <div>...</div>
  ))
) : (
  <p className="text-center text-gray-500 py-4">æš‚æ— æ•°æ®</p>
)}
```

#### 2.4 æœ€è¿‘è®¢å•åˆ—è¡¨

**æ˜¾ç¤ºå­—æ®µï¼š**
- è®¢å•å·
- ç”¨æˆ·å
- è®¢å•é‡‘é¢
- è®¢å•çŠ¶æ€
- åˆ›å»ºæ—¶é—´

**å¸¸è§é—®é¢˜ä¿®å¤ï¼š**
```typescript
// è®¢å•é‡‘é¢å®‰å…¨æ˜¾ç¤º
Â¥{order.total_amount ? parseFloat(order.total_amount).toFixed(2) : '0.00'}

// ç”¨æˆ·åç©ºå€¼å¤„ç†
{order.username || 'æœªçŸ¥ç”¨æˆ·'}

// æ—¶é—´æ ¼å¼åŒ–
{new Date(order.created_at).toLocaleString('zh-CN')}
```

---

### ğŸ‘¥ åŠŸèƒ½3: ç”¨æˆ·ç®¡ç†æ¨¡å—

**è·¯ç”±ï¼š** `/admin/users`

**åŠŸèƒ½æ¸…å•ï¼š**
- [x] ç”¨æˆ·åˆ—è¡¨åˆ†é¡µ
- [x] æœç´¢ç”¨æˆ·ï¼ˆç”¨æˆ·å/é‚®ç®±/æ‰‹æœºï¼‰
- [x] æ˜¾ç¤ºç”¨æˆ·è®¢å•æ•°
- [x] æ˜¾ç¤ºç”¨æˆ·æ¶ˆè´¹æ€»é¢
- [x] æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…
- [ ] ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆæš‚æœªå®ç°ï¼‰

**æ•°æ®å­—æ®µï¼š**
| å­—æ®µ | è¯´æ˜ | æ¥æº |
|-----|------|------|
| username | ç”¨æˆ·å | users è¡¨ |
| email | é‚®ç®± | users è¡¨ |
| phone | æ‰‹æœºå· | users è¡¨ |
| order_count | è®¢å•æ•° | å…³è”æŸ¥è¯¢ orders |
| total_spent | æ¶ˆè´¹æ€»é¢ | SUM(orders.total_amount) |
| created_at | æ³¨å†Œæ—¶é—´ | users è¡¨ |

**åç«¯å®ç°ï¼š**

```typescript
// GET /api/admin/users
const [users] = await pool.query(`
  SELECT 
    u.user_id,
    u.username,
    u.email,
    u.phone,
    u.created_at,
    (SELECT COUNT(*) FROM orders o WHERE o.user_id = u.user_id) as order_count,
    (SELECT COALESCE(SUM(total_amount), 0) 
     FROM orders o 
     WHERE o.user_id = u.user_id AND o.status IN (1,2,3)) as total_spent
  FROM users u
  WHERE ${whereClause}
  ORDER BY u.created_at DESC
  LIMIT ? OFFSET ?
`);
```

**å¸¸è§é—®é¢˜ï¼š**

âŒ **é—®é¢˜ï¼š** ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢å¤±è´¥ï¼Œ`Unknown column 'u.status'`

**åŸå› ï¼š** users è¡¨ä¸­æ²¡æœ‰ status å­—æ®µ

**è§£å†³ï¼š** ä»æŸ¥è¯¢ä¸­ç§»é™¤ status å­—æ®µ

#### ç”¨æˆ·çŠ¶æ€ç®¡ç†åŠŸèƒ½ï¼ˆæœªå®ç°ï¼‰

**çŠ¶æ€ï¼š** âš ï¸ åŠŸèƒ½æš‚ä¸å¯ç”¨

**åŸå› ï¼š** æ•°æ®åº“ users è¡¨ä¸­æ²¡æœ‰ status å­—æ®µ

**å¦‚éœ€å®ç°ï¼š**
```sql
-- 1. æ·»åŠ å­—æ®µ
ALTER TABLE users 
ADD COLUMN status TINYINT DEFAULT 1 
COMMENT 'ç”¨æˆ·çŠ¶æ€: 1-æ­£å¸¸, 0-ç¦ç”¨';

-- 2. ä¸ºç°æœ‰ç”¨æˆ·è®¾ç½®é»˜è®¤å€¼
UPDATE users SET status = 1;
```

ç„¶åæ¢å¤åç«¯ä»£ç ä¸­çš„ status ç›¸å…³é€»è¾‘ã€‚

---

### ğŸ“¦ åŠŸèƒ½4: è®¢å•ç®¡ç†æ¨¡å—

**è·¯ç”±ï¼š** `/admin/orders`

**åŠŸèƒ½ï¼š**
- [x] è®¢å•åˆ—è¡¨åˆ†é¡µ
- [x] æŒ‰çŠ¶æ€ç­›é€‰
- [x] æ˜¾ç¤ºè®¢å•è¯¦æƒ…
- [x] æ›´æ–°è®¢å•çŠ¶æ€
- [x] è®¢å•å‘è´§æ“ä½œ

**è®¢å•çŠ¶æ€æµè½¬ï¼š**
```
å¾…æ”¯ä»˜(0) â†’ å·²æ”¯ä»˜(1) â†’ å·²å‘è´§(2) â†’ å·²å®Œæˆ(3)
   â†“
 å·²å–æ¶ˆ(4)
```

**ç®¡ç†å‘˜æ“ä½œæƒé™ï¼š**
- å¯ä»¥å°†"å·²æ”¯ä»˜"æ”¹ä¸º"å·²å‘è´§"
- å¯ä»¥å–æ¶ˆ"å¾…æ”¯ä»˜"è®¢å•
- ä¸èƒ½ä¿®æ”¹"å·²å®Œæˆ"æˆ–"å·²å–æ¶ˆ"çš„è®¢å•

**åç«¯å®ç°ï¼š**

```typescript
// PUT /api/admin/orders/:orderId
export const updateOrderStatus = async (req: Request, res: Response) => {
  const { orderId } = req.params;
  const { status } = req.body;
  
  // éªŒè¯çŠ¶æ€å€¼
  if (![0, 1, 2, 3, 4].includes(status)) {
    return res.status(400).json({ error: 'æ— æ•ˆçš„çŠ¶æ€å€¼' });
  }
  
  // è·å–å½“å‰è®¢å•çŠ¶æ€
  const [orders] = await pool.query(
    'SELECT status FROM orders WHERE order_id = ?',
    [orderId]
  );
  
  if (orders.length === 0) {
    return res.status(404).json({ error: 'è®¢å•ä¸å­˜åœ¨' });
  }
  
  const currentStatus = orders[0].status;
  
  // çŠ¶æ€æµè½¬éªŒè¯
  if (currentStatus === 3 || currentStatus === 4) {
    return res.status(400).json({ error: 'è¯¥è®¢å•çŠ¶æ€ä¸å¯ä¿®æ”¹' });
  }
  
  // æ›´æ–°çŠ¶æ€
  await pool.query(
    'UPDATE orders SET status = ?, updated_at = NOW() WHERE order_id = ?',
    [status, orderId]
  );
  
  // è®°å½•æ“ä½œæ—¥å¿—
  await logAdminAction(
    req.admin.adminId,
    'UPDATE_ORDER_STATUS',
    'order',
    orderId,
    `æ›´æ–°è®¢å•çŠ¶æ€: ${statusMap[currentStatus]} â†’ ${statusMap[status]}`,
    req.ip,
    req.get('user-agent')
  );
  
  res.json({ message: 'æ›´æ–°æˆåŠŸ' });
};
```

---

### ğŸ“ åŠŸèƒ½5: ç³»ç»Ÿæ—¥å¿—

**è·¯ç”±ï¼š** `/admin/logs`

**æ—¥å¿—ç±»å‹ï¼š**
- ç®¡ç†å‘˜ç™»å½•/ç™»å‡º
- å•†å“æ“ä½œï¼ˆåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€ä¸Šä¸‹æ¶ï¼‰
- è®¢å•æ“ä½œï¼ˆçŠ¶æ€æ›´æ–°ã€å‘è´§ï¼‰
- ç”¨æˆ·æ“ä½œï¼ˆçŠ¶æ€æ›´æ–°ï¼‰
- SKUæ“ä½œï¼ˆåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ï¼‰

**æ—¥å¿—è¡¨ç»“æ„ï¼š**
```sql
CREATE TABLE admin_logs (
  log_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  admin_id INT NOT NULL,
  action VARCHAR(50) NOT NULL,
  target_type VARCHAR(20),
  target_id VARCHAR(100),
  description TEXT,
  ip_address VARCHAR(50),
  user_agent TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_admin (admin_id),
  INDEX idx_action (action),
  INDEX idx_created (created_at)
);
```

**è®°å½•æ—¥å¿—çš„å‡½æ•°ï¼š**
```typescript
export async function logAdminAction(
  adminId: number,
  action: string,
  targetType: string,
  targetId: string,
  description: string,
  ipAddress?: string,
  userAgent?: string
) {
  const pool = getPool();
  
  await pool.query(
    `INSERT INTO admin_logs 
     (admin_id, action, target_type, target_id, description, ip_address, user_agent, created_at)
     VALUES (?, ?, ?, ?, ?, ?, ?, NOW())`,
    [adminId, action, targetType, targetId, description, ipAddress, userAgent]
  );
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```typescript
// åœ¨å•†å“åˆ›å»ºæ—¶è®°å½•
await logAdminAction(
  req.admin.adminId,
  'CREATE_PRODUCT',
  'product',
  productId.toString(),
  `åˆ›å»ºå•†å“: ${title}`,
  req.ip,
  req.get('user-agent')
);

// åœ¨SKUåˆ›å»ºæ—¶è®°å½•
await logAdminAction(
  req.admin.adminId,
  'CREATE_SKU',
  'sku',
  skuId.toString(),
  `ä¸ºå•†å“${productId}åˆ›å»ºSKU: ${sku_code}`,
  req.ip,
  req.get('user-agent')
);
```

---

## ğŸ” è®¤è¯å’Œæƒé™ç³»ç»Ÿ

### ç®¡ç†å‘˜ç™»å½•æµç¨‹

```typescript
// 1. å‰ç«¯æäº¤ç™»å½•è¡¨å•
POST /api/admin/login
Body: { username, password }

// 2. åç«¯éªŒè¯å¯†ç 
const admin = await AdminModel.findByUsername(username);
const isValid = await bcrypt.compare(password, admin.password_hash);

if (!isValid) {
  return res.status(401).json({ error: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯' });
}

// 3. ç”Ÿæˆ JWT Token
const token = jwt.sign(
  { 
    adminId: admin.admin_id,
    username: admin.username,
    role: admin.role 
  },
  process.env.JWT_SECRET,
  { expiresIn: '24h' }
);

// 4. è¿”å› Token å’Œç®¡ç†å‘˜ä¿¡æ¯
res.json({ 
  token,
  admin: {
    admin_id: admin.admin_id,
    username: admin.username,
    role: admin.role
  }
});

// 5. å‰ç«¯å­˜å‚¨ Token
localStorage.setItem('admin_token', token);
localStorage.setItem('admin_info', JSON.stringify(admin));

// 6. åç»­è¯·æ±‚æºå¸¦ Token
Headers: {
  Authorization: `Bearer ${token}`
}
```

### æƒé™éªŒè¯ä¸­é—´ä»¶

**æ–‡ä»¶ï¼š** `backend/src/middleware/admin-auth.ts`

```typescript
export const authenticateAdmin = async (
  req: Request,
  res: Response,
  next: NextFunction
) => {
  try {
    const token = req.headers.authorization?.split(' ')[1];
    
    if (!token) {
      return res.status(401).json({ error: 'æœªæˆæƒï¼Œè¯·å…ˆç™»å½•' });
    }
    
    const decoded = jwt.verify(token, process.env.JWT_SECRET!) as any;
    req.admin = decoded;
    
    next();
  } catch (error) {
    return res.status(401).json({ error: 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•' });
  }
};

// æƒé™æ£€æŸ¥
export const requirePermission = (permission: string) => {
  return async (req: Request, res: Response, next: NextFunction) => {
    const admin = req.admin;
    
    // æ£€æŸ¥æƒé™
    const hasPermission = await checkAdminPermission(admin.adminId, permission);
    
    if (!hasPermission) {
      return res.status(403).json({ error: 'æƒé™ä¸è¶³' });
    }
    
    next();
  };
};
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```typescript
// è·¯ç”±ä¸­ä½¿ç”¨
router.get('/', authenticateAdmin, requirePermission('product:view'), getProducts);
router.post('/', authenticateAdmin, requirePermission('product:create'), createProduct);
router.put('/:id', authenticateAdmin, requirePermission('product:edit'), updateProduct);
router.delete('/:id', authenticateAdmin, requirePermission('product:delete'), deleteProduct);
```

---

## ğŸ¨ UI/UXè®¾è®¡è§„èŒƒ

### å¸ƒå±€ç»“æ„

**ç»„ä»¶ï¼š** `AdminLayout`

```tsx
<AdminLayout>
  <Sidebar>              {/* å·¦ä¾§å¯¼èˆªæ  */}
    - ä»ªè¡¨ç›˜
    - å•†å“ç®¡ç†
    - è®¢å•ç®¡ç†
    - ç”¨æˆ·ç®¡ç†
    - ç³»ç»Ÿæ—¥å¿—
  </Sidebar>
  
  <div className="flex-1">
    <Header>             {/* é¡¶éƒ¨æ  */}
      - é¢åŒ…å±‘å¯¼èˆª
      - ç®¡ç†å‘˜ä¿¡æ¯
      - ç™»å‡ºæŒ‰é’®
    </Header>
    
    <MainContent>        {/* ä¸»å†…å®¹åŒº */}
      {children}
    </MainContent>
  </div>
</AdminLayout>
```

### é¢œè‰²ä¸»é¢˜

**ç®¡ç†åå°ä¸“ç”¨è‰²ç³»ï¼š**
```typescript
// ä¸»è‰²è°ƒ
primary: blue-600      // ä¸»æ“ä½œæŒ‰é’®
success: green-500     // æˆåŠŸçŠ¶æ€
warning: orange-500    // è­¦å‘ŠçŠ¶æ€
danger: red-500        // å±é™©æ“ä½œ
info: blue-400         // ä¿¡æ¯æç¤º

// çŠ¶æ€é¢œè‰²
status: {
  0: gray-500,         // å¾…æ”¯ä»˜
  1: green-500,        // å·²æ”¯ä»˜
  2: blue-500,         // å·²å‘è´§
  3: purple-500,       // å·²å®Œæˆ
  4: red-500           // å·²å–æ¶ˆ
}
```

### å›¾è¡¨é…ç½®

**Recharts ä¸»é¢˜ï¼š**
```typescript
const chartColors = {
  primary: '#3b82f6',    // è“è‰² - é”€å”®é¢
  success: '#10b981',    // ç»¿è‰² - è®¢å•æ•°
  warning: '#f59e0b',    // æ©™è‰² - è­¦å‘Šæ•°æ®
  danger: '#ef4444'      // çº¢è‰² - å¼‚å¸¸æ•°æ®
};
```

---

## ğŸ› å¸¸è§é—®é¢˜æ±‡æ€»

### é—®é¢˜1: é¡µé¢åŠ è½½TypeError

**ç—‡çŠ¶ï¼š** `TypeError: s.toFixed is not a function`

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
// å°è£…å·¥å…·å‡½æ•°
const formatPrice = (price: any): string => {
  const num = parseFloat(price);
  return isNaN(num) ? '0.00' : num.toFixed(2);
};

const formatNumber = (value: any, defaultValue: number = 0): number => {
  const num = Number(value);
  return isNaN(num) ? defaultValue : num;
};

// ä½¿ç”¨
Â¥{formatPrice(product.price)}
é”€é‡: {formatNumber(product.sales_count)}ä»¶
```

### é—®é¢˜2: æ¨¡æ€æ¡†å…³é—­åæ•°æ®æ®‹ç•™

**ç—‡çŠ¶ï¼š** å†æ¬¡æ‰“å¼€æ¨¡æ€æ¡†æ˜¾ç¤ºä¸Šæ¬¡çš„æ•°æ®

**è§£å†³ï¼š**
```typescript
const closeModal = () => {
  setShowModal(false);
  // é‡ç½®è¡¨å•
  setFormData({
    title: '',
    price: '',
    stock: '',
    category_id: '',
    // ...
  });
};
```

### é—®é¢˜3: åˆ†ç±»åˆ—è¡¨ä¸ºç©º

**ç—‡çŠ¶ï¼š** æ·»åŠ å•†å“æ—¶åˆ†ç±»ä¸‹æ‹‰æ¡†æ²¡æœ‰é€‰é¡¹

**è§£å†³ï¼š**
```typescript
useEffect(() => {
  fetchCategories();
}, []);

const fetchCategories = async () => {
  try {
    const response = await fetch(
      `${process.env.NEXT_PUBLIC_API_URL}/products/categories`
    );
    const data = await response.json();
    setCategories(Array.isArray(data) ? data : []);
  } catch (error) {
    console.error('è·å–åˆ†ç±»å¤±è´¥:', error);
    setCategories([]);
  }
};
```

### é—®é¢˜4: Tokenè¿‡æœŸ

**ç—‡çŠ¶ï¼š** è¯·æ±‚è¿”å› 401 Unauthorized

**è§£å†³ï¼š**
```typescript
// APIæ‹¦æˆªå™¨
const fetchWithAuth = async (url: string, options = {}) => {
  const token = localStorage.getItem('admin_token');
  const response = await fetch(url, {
    ...options,
    headers: {
      'Authorization': `Bearer ${token}`,
      ...options.headers,
    },
  });
  
  if (response.status === 401) {
    toast.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
    localStorage.removeItem('admin_token');
    localStorage.removeItem('admin_info');
    router.push('/admin/login');
    throw new Error('Unauthorized');
  }
  
  return response;
};
```

### é—®é¢˜5: æ•°ç»„æ•°æ®ä¸ºnullå¯¼è‡´å´©æºƒ

**ç—‡çŠ¶ï¼š** `Cannot read property 'map' of null`

**è§£å†³ï¼š**
```typescript
// åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„
const [products, setProducts] = useState<Product[]>([]);
const [orders, setOrders] = useState<Order[]>([]);

// APIè¿”å›æ•°æ®å¤„ç†
const data = await response.json();
setProducts(Array.isArray(data) ? data : data.products || []);

// æ¸²æŸ“å‰æ£€æŸ¥
{products.length > 0 ? (
  products.map(...)
) : (
  <EmptyState />
)}
```

---

## ğŸ“Š ç®¡ç†åå°ç»Ÿè®¡æ•°æ®

### é¡µé¢æ•°é‡
- ç™»å½•é¡µï¼š1ä¸ª
- åŠŸèƒ½é¡µï¼š5ä¸ªï¼ˆä»ªè¡¨ç›˜ã€å•†å“ã€è®¢å•ã€ç”¨æˆ·ã€æ—¥å¿—ï¼‰

### APIæ¥å£
- ç®¡ç†å‘˜è®¤è¯ï¼š1ä¸ª
- æ•°æ®ç»Ÿè®¡ï¼š3ä¸ª
- å•†å“ç®¡ç†ï¼š5ä¸ª + SKUç®¡ç†ï¼š5ä¸ª
- è®¢å•ç®¡ç†ï¼š3ä¸ª
- ç”¨æˆ·ç®¡ç†ï¼š4ä¸ª

### ä»£ç é‡
- é¡µé¢ä»£ç ï¼š~2500è¡Œ
- TypeScriptï¼š100%
- æ ·å¼ï¼šTailwindCSS

### åŠŸèƒ½å®Œæˆåº¦
```
âœ… ç®¡ç†å‘˜ç™»å½•/ç™»å‡º      100%
âœ… æ•°æ®ç»Ÿè®¡ä»ªè¡¨ç›˜        100%
âœ… å•†å“ç®¡ç†             100%
âœ… SKUç®¡ç†              100%
âœ… è®¢å•ç®¡ç†             100%
âœ… ç”¨æˆ·ç®¡ç†              90%ï¼ˆç¼ºç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼‰
âœ… ç³»ç»Ÿæ—¥å¿—             100%
```

---

## ğŸ“ å¾…å®ç°åŠŸèƒ½

### çŸ­æœŸè®¡åˆ’
- [ ] å•†å“ç¼–è¾‘åŠŸèƒ½å¢å¼º
- [ ] å•†å“æ‰¹é‡åˆ é™¤
- [ ] ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆéœ€æ·»åŠ æ•°æ®åº“å­—æ®µï¼‰
- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆExcelï¼‰
- [ ] é«˜çº§æœç´¢å’Œç­›é€‰

### ä¸­æœŸè®¡åˆ’
- [ ] å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼ˆOSSé›†æˆï¼‰
- [ ] å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå•†å“æè¿°ï¼‰
- [ ] æ•°æ®å¯è§†åŒ–å¢å¼º
- [ ] æ“ä½œå®¡è®¡è¿½è¸ª

### é•¿æœŸè®¡åˆ’
- [ ] æƒé™è§’è‰²ç³»ç»Ÿå®Œå–„
- [ ] å¤šç®¡ç†å‘˜åä½œ
- [ ] å®æ—¶æ•°æ®æ¨é€
- [ ] ç§»åŠ¨ç«¯ç®¡ç†åº”ç”¨

---

## ğŸ› ï¸ å¼€å‘å·¥å…·å’Œè„šæœ¬

### å¿«é€Ÿå¯åŠ¨

```bash
# å¼€å‘ç¯å¢ƒå¯åŠ¨
cd /path/to/project
./start-dev.sh

# æˆ–æ‰‹åŠ¨å¯åŠ¨
docker-compose up -d mysql redis mongodb
cd backend && npm run dev
cd frontend && npm run dev
```

### æ•°æ®åº“ç®¡ç†

```bash
# è¿›å…¥MySQL
docker exec -it ecommerce-mysql mysql -uroot -proot123456 ecommerce

# å¸¸ç”¨æŸ¥è¯¢
SHOW TABLES;
DESCRIBE products;
SELECT * FROM admin_logs ORDER BY created_at DESC LIMIT 10;

# æ•°æ®å¤‡ä»½
docker exec ecommerce-mysql mysqldump -uroot -proot123456 ecommerce > backup.sql

# æ•°æ®æ¢å¤
docker exec -i ecommerce-mysql mysql -uroot -proot123456 ecommerce < backup.sql
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# Dockeræ—¥å¿—
docker-compose logs -f backend
docker-compose logs --tail=50 mysql

# åº”ç”¨æ—¥å¿—
tail -f backend/logs/app.log
tail -f backend/logs/error.log
```

---

## ğŸ’¡ ç®¡ç†åå°æœ€ä½³å®è·µ

### 1. æ•°æ®è¡¨æ ¼è®¾è®¡

**åˆ†é¡µåŠ è½½ï¼š**
```typescript
const [page, setPage] = useState(1);
const [limit] = useState(20);
const [total, setTotal] = useState(0);

const fetchData = async () => {
  const response = await fetch(
    `${API_URL}?page=${page}&limit=${limit}`
  );
  const data = await response.json();
  setItems(data.items);
  setTotal(data.pagination.total);
};
```

**æœç´¢å’Œç­›é€‰ï¼š**
```typescript
const [filters, setFilters] = useState({
  keyword: '',
  category: '',
  status: ''
});

useEffect(() => {
  fetchData();
}, [page, filters]);  // ä¾èµ–å˜åŒ–æ—¶é‡æ–°è·å–
```

### 2. æ“ä½œç¡®è®¤

**å±é™©æ“ä½œéœ€è¦äºŒæ¬¡ç¡®è®¤ï¼š**
```typescript
const handleDelete = async (id: number) => {
  if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•†å“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
    return;
  }
  
  try {
    await api.delete(`/products/${id}`);
    toast.success('åˆ é™¤æˆåŠŸ');
    fetchData();  // åˆ·æ–°åˆ—è¡¨
  } catch (error) {
    toast.error('åˆ é™¤å¤±è´¥');
  }
};
```

### 3. æ‰¹é‡æ“ä½œ

**æ‰¹é‡é€‰æ‹©ï¼š**
```typescript
const [selectedIds, setSelectedIds] = useState<number[]>([]);

// å…¨é€‰/å–æ¶ˆå…¨é€‰
const handleSelectAll = (checked: boolean) => {
  setSelectedIds(checked ? items.map(item => item.id) : []);
};

// å•ä¸ªé€‰æ‹©
const handleSelectOne = (id: number, checked: boolean) => {
  setSelectedIds(prev => 
    checked 
      ? [...prev, id]
      : prev.filter(i => i !== id)
  );
};

// æ‰¹é‡æ“ä½œ
const handleBatchAction = async (action: string) => {
  if (selectedIds.length === 0) {
    toast.error('è¯·å…ˆé€‰æ‹©å•†å“');
    return;
  }
  
  await api.post(`/products/batch/${action}`, {
    product_ids: selectedIds
  });
  
  setSelectedIds([]);
  fetchData();
};
```

### 4. å®æ—¶æ•°æ®æ›´æ–°

**å®šæ—¶åˆ·æ–°ï¼š**
```typescript
useEffect(() => {
  const interval = setInterval(() => {
    fetchStats();  // æ¯30ç§’åˆ·æ–°ç»Ÿè®¡æ•°æ®
  }, 30000);
  
  return () => clearInterval(interval);
}, []);
```

---

## ğŸ“ è®¿é—®ä¿¡æ¯

**ç®¡ç†åå°åœ°å€ï¼š** http://localhost:3000/admin/login

**é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼š**
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

**é¡µé¢å¯¼èˆªï¼š**
- ä»ªè¡¨ç›˜ï¼š`/admin/dashboard`
- å•†å“ç®¡ç†ï¼š`/admin/products`
- è®¢å•ç®¡ç†ï¼š`/admin/orders`
- ç”¨æˆ·ç®¡ç†ï¼š`/admin/users`
- ç³»ç»Ÿæ—¥å¿—ï¼š`/admin/logs`

---

## ğŸ“… 2025å¹´10æœˆ29æ—¥ - å•†å“ç¼–è¾‘åŠŸèƒ½ä¿®å¤

### ğŸ› é—®é¢˜ï¼šå•†å“ç¼–è¾‘æŒ‰é’®ä¸å¯ç”¨

**è®¿é—®åœ°å€ï¼š** http://localhost:3000/admin/products

**é—®é¢˜ç°è±¡ï¼š**
- å•†å“åˆ—è¡¨ä¸­æœ‰"ç¼–è¾‘"æŒ‰é’®
- ç‚¹å‡»æŒ‰é’®æ— ä»»ä½•ååº”
- æ§åˆ¶å°æ— é”™è¯¯ä¿¡æ¯

**é—®é¢˜åŸå› ï¼š**

æ£€æŸ¥ä»£ç å‘ç°ï¼Œç¼–è¾‘æŒ‰é’®æ²¡æœ‰ç»‘å®šä»»ä½•ç‚¹å‡»äº‹ä»¶ï¼š

```tsx
// âŒ é—®é¢˜ä»£ç 
<button className="text-blue-600 hover:text-blue-900">ç¼–è¾‘</button>
```

ç¼ºå°‘ï¼š
1. ç¼–è¾‘æ¨¡æ€æ¡†ç»„ä»¶
2. ç¼–è¾‘çŠ¶æ€ç®¡ç†
3. ç¼–è¾‘æ•°æ®å¤„ç†å‡½æ•°
4. onClick äº‹ä»¶ç»‘å®š

**è§£å†³æ–¹æ¡ˆï¼š**

#### 1. æ·»åŠ ç¼–è¾‘çŠ¶æ€ç®¡ç†

**æ–‡ä»¶ï¼š** `frontend/src/app/admin/products/page.tsx`

```typescript
// æ·»åŠ ç¼–è¾‘ç›¸å…³çš„çŠ¶æ€
const [showEditModal, setShowEditModal] = useState(false);
const [editProduct, setEditProduct] = useState<any>(null);
```

#### 2. åˆ›å»ºæ‰“å¼€ç¼–è¾‘æ¡†å‡½æ•°

```typescript
const openEditModal = (product: any) => {
  setEditProduct({
    product_id: product.product_id,
    title: product.title,
    description: product.description || '',
    price: product.price.toString(),
    stock: product.stock.toString(),
    category_id: product.category_id.toString(),
    brand: product.brand || '',
    main_image: product.main_image || '',
    status: product.status
  });
  setShowEditModal(true);
};
```

#### 3. åˆ›å»ºç¼–è¾‘å¤„ç†å‡½æ•°

```typescript
const handleEditProduct = async () => {
  // éªŒè¯è¡¨å•
  if (!editProduct.title || !editProduct.price || !editProduct.category_id) {
    toast.error('è¯·å¡«å†™å•†å“æ ‡é¢˜ã€ä»·æ ¼å’Œåˆ†ç±»');
    return;
  }

  try {
    const token = localStorage.getItem('admin_token');
    
    const response = await fetch(
      `${process.env.NEXT_PUBLIC_API_URL}/admin/products/${editProduct.product_id}`,
      {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          title: editProduct.title,
          description: editProduct.description,
          price: parseFloat(editProduct.price),
          stock: parseInt(editProduct.stock) || 0,
          category_id: parseInt(editProduct.category_id),
          brand: editProduct.brand,
          image_url: editProduct.main_image,
          status: editProduct.status
        })
      }
    );

    const data = await response.json();
    
    if (response.ok) {
      toast.success('å•†å“æ›´æ–°æˆåŠŸ');
      setShowEditModal(false);
      setEditProduct(null);
      fetchProducts();  // åˆ·æ–°åˆ—è¡¨
    } else {
      toast.error(data.error || 'æ›´æ–°å¤±è´¥');
    }
  } catch (error) {
    console.error('æ›´æ–°å•†å“å¤±è´¥:', error);
    toast.error('æ›´æ–°å•†å“å¤±è´¥');
  }
};
```

#### 4. ç»‘å®šç¼–è¾‘æŒ‰é’®äº‹ä»¶

```tsx
// âœ… ä¿®å¤åçš„ä»£ç 
<button 
  onClick={() => openEditModal(product)}
  className="text-blue-600 hover:text-blue-900"
>
  ç¼–è¾‘
</button>
```

#### 5. åˆ›å»ºç¼–è¾‘æ¨¡æ€æ¡†

æ·»åŠ å®Œæ•´çš„ç¼–è¾‘æ¨¡æ€æ¡†ç»„ä»¶ï¼ˆä¸æ·»åŠ æ¨¡æ€æ¡†ç±»ä¼¼çš„ç»“æ„ï¼‰ï¼š

```tsx
{/* ç¼–è¾‘å•†å“æ¨¡æ€æ¡† */}
{showEditModal && editProduct && (
  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div className="p-6">
        <div className="flex items-center justify-between mb-6">
          <h2 className="text-2xl font-bold text-gray-900">ç¼–è¾‘å•†å“</h2>
          <button
            onClick={() => {
              setShowEditModal(false);
              setEditProduct(null);
            }}
            className="text-gray-400 hover:text-gray-600"
          >
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <div className="space-y-4">
          {/* å•†å“æ ‡é¢˜ */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              å•†å“æ ‡é¢˜ <span className="text-red-500">*</span>
            </label>
            <input
              type="text"
              value={editProduct.title}
              onChange={(e) => setEditProduct({ ...editProduct, title: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg"
            />
          </div>

          {/* ... å…¶ä»–è¡¨å•å­—æ®µ ... */}

          {/* ä»·æ ¼å’Œåº“å­˜ */}
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                ä»·æ ¼ (å…ƒ) <span className="text-red-500">*</span>
              </label>
              <input
                type="number"
                step="0.01"
                value={editProduct.price}
                onChange={(e) => setEditProduct({ ...editProduct, price: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                åº“å­˜
              </label>
              <input
                type="number"
                value={editProduct.stock}
                onChange={(e) => setEditProduct({ ...editProduct, stock: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg"
              />
            </div>
          </div>
        </div>

        {/* æŒ‰é’® */}
        <div className="flex justify-end space-x-3 mt-6">
          <button
            onClick={() => {
              setShowEditModal(false);
              setEditProduct(null);
            }}
            className="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"
          >
            å–æ¶ˆ
          </button>
          <button
            onClick={handleEditProduct}
            className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            ä¿å­˜ä¿®æ”¹
          </button>
        </div>
      </div>
    </div>
  </div>
)}
```

### âœ… ä¿®å¤ç»“æœ

**ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
- `frontend/src/app/admin/products/page.tsx`

**ä¿®æ”¹å†…å®¹ï¼š**
- æ–°å¢çŠ¶æ€ï¼š`showEditModal`, `editProduct`
- æ–°å¢å‡½æ•°ï¼š`openEditModal()`, `handleEditProduct()`
- æ–°å¢ç»„ä»¶ï¼šç¼–è¾‘å•†å“æ¨¡æ€æ¡†
- ä¿®æ”¹æŒ‰é’®ï¼šç»‘å®š onClick äº‹ä»¶

**åŠŸèƒ½æ¸…å•ï¼š**
- âœ… ç‚¹å‡»ç¼–è¾‘æŒ‰é’®æ‰“å¼€æ¨¡æ€æ¡†
- âœ… è‡ªåŠ¨å¡«å……å½“å‰å•†å“æ•°æ®
- âœ… è¡¨å•éªŒè¯
- âœ… æäº¤æ›´æ–°åˆ°åç«¯ API
- âœ… æ›´æ–°æˆåŠŸååˆ·æ–°åˆ—è¡¨
- âœ… æ˜¾ç¤ºæˆåŠŸ/å¤±è´¥æç¤º
- âœ… å…³é—­æ¨¡æ€æ¡†æ—¶æ¸…ç†æ•°æ®

**æµ‹è¯•æ–¹å¼ï¼š**
1. è®¿é—® http://localhost:3000/admin/products
2. ç™»å½•ç®¡ç†å‘˜è´¦å·
3. åœ¨å•†å“åˆ—è¡¨ä¸­ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®
4. ä¿®æ”¹å•†å“ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€ä»·æ ¼ã€åº“å­˜ç­‰ï¼‰
5. ç‚¹å‡»"ä¿å­˜ä¿®æ”¹"
6. éªŒè¯å•†å“ä¿¡æ¯æ˜¯å¦æ›´æ–°æˆåŠŸ

**APIè°ƒç”¨ï¼š**
```
PUT /api/admin/products/:productId
Authorization: Bearer <admin_token>
Content-Type: application/json

Body: {
  "title": "å•†å“æ ‡é¢˜",
  "description": "å•†å“æè¿°",
  "price": 99.99,
  "stock": 100,
  "category_id": 1,
  "brand": "å“ç‰Œå",
  "image_url": "å›¾ç‰‡URL",
  "status": 1
}
```

**æ›´æ–°å†…å®¹ï¼š**
- ä»£ç è¡Œæ•°ï¼š+230è¡Œ
- åŠŸèƒ½å®Œæˆåº¦ï¼š100%
- ç¼–è¯‘çŠ¶æ€ï¼šâœ… æ— é”™è¯¯

---

**æœ€åæ›´æ–°ï¼š** 2025å¹´10æœˆ29æ—¥  
**ç®¡ç†åå°çŠ¶æ€ï¼š** âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸  
**æ ¸å¿ƒåŠŸèƒ½å®Œæˆåº¦ï¼š** 100%  
**ç”¨æˆ·ä½“éªŒï¼š** â­â­â­â­â­

